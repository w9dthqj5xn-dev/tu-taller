<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Licencias - Tu Taller</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* Cuando solo el login est√° visible */
        body.login-mode {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Cuando el dashboard est√° activo */
        body.dashboard-mode {
            background: #f8fafc;
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(102, 126, 234, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.8);
            width: 100%;
            max-width: 1200px;
            padding: 0;
            animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }

        .dashboard {
            display: flex;
            height: 100vh;
            max-height: 900px;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            padding: 30px 20px;
            color: white;
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .sidebar-header h1 {
            font-size: 1.8em;
            font-weight: 800;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .sidebar-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            font-weight: 500;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateX(4px);
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 1.2em;
        }

        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f8fafc;
        }

        .content-header {
            margin-bottom: 30px;
        }

        .content-header h2 {
            font-size: 2em;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .content-header p {
            color: #64748b;
            font-size: 16px;
        }

        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 24px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f1f5f9;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
        }

        .card-icon {
            margin-right: 12px;
            font-size: 1.5em;
            color: #667eea;
        }

        .login-section, .generator-section {
            display: none;
        }

        .login-section.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            max-width: 420px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .generator-section.active {
            display: block;
        }

        .login-section .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease-out;
        }

        .login-section .header h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 16px;
            line-height: 1.1;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
            text-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .login-section .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            margin: 0;
            font-weight: 500;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        #loginForm {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 50px 40px;
            border-radius: 30px;
            box-shadow: 
                0 25px 50px rgba(102, 126, 234, 0.15),
                0 8px 32px rgba(118, 75, 162, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.8s ease-out 0.2s both;
            width: 100%;
        }

        #loginForm::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        .form-group {
            margin-bottom: 32px;
            position: relative;
        }

        .form-group label {
            display: block;
            color: #1f2937;
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            padding-left: 32px;
        }

        .form-group label::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background-size: contain;
            opacity: 0.7;
        }

        .form-group:first-of-type label::before {
            content: 'üë§';
            font-size: 16px;
        }

        .form-group:last-of-type label::before {
            content: 'üîí';
            font-size: 16px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 16px;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(248, 250, 252, 0.8);
            backdrop-filter: blur(10px);
            color: #1f2937;
            box-sizing: border-box;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 
                0 0 0 4px rgba(102, 126, 234, 0.15),
                0 8px 25px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .form-group input::placeholder {
            color: #9ca3af;
            font-style: italic;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid #667eea;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 4px;
        }

        .stat-label {
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
            min-width: auto;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            color: white;
            box-shadow: 
                0 8px 30px rgba(102, 126, 234, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            padding: 18px 32px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            position: relative;
            overflow: hidden;
            animation: pulse 2s infinite;
        }

        .btn-primary::before {
            content: 'üöÄ';
            margin-right: 12px;
            font-size: 18px;
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 15px 40px rgba(102, 126, 234, 0.6),
                0 5px 15px rgba(118, 75, 162, 0.4);
            animation: gradientShift 0.5s ease;
        }

        .btn-primary:active {
            transform: translateY(-1px) scale(1.01);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(100, 116, 139, 0.4);
        }

        .btn-outline {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-outline:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-error {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            color: #991b1b;
            border: 2px solid #fca5a5;
            border-radius: 16px;
            padding: 16px 20px;
            font-weight: 600;
            font-size: 15px;
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.2);
            animation: slideInDown 0.5s ease;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .alert-error::before {
            content: '‚ö†Ô∏è';
            margin-right: 12px;
            font-size: 18px;
        }

        /* ================================================
           RESPONSIVE DESIGN - MEDIA QUERIES
           ================================================ */

        /* Mobile Portrait - hasta 480px */
        @media (max-width: 480px) {
            .generator-section .mobile-menu-toggle {
                display: block !important;
            }
            .login-section.active {
                padding: 20px 15px;
                max-width: 100%;
                min-height: 100vh;
            }

            .login-section .header h1 {
                font-size: 2rem;
                margin-bottom: 12px;
            }

            .login-section .header p {
                font-size: 1rem;
            }

            #loginForm {
                padding: 30px 20px;
                border-radius: 20px;
            }

            .form-group input {
                padding: 16px 20px;
                font-size: 16px;
            }

            .btn-primary {
                padding: 16px 24px;
                font-size: 15px;
            }

            .dashboard {
                flex-direction: column;
                height: auto;
                max-height: none;
            }

            .sidebar {
                width: 280px;
                padding: 20px 15px;
                position: fixed;
                top: 0;
                left: -100%;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
                background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
                box-shadow: 2px 0 20px rgba(0,0,0,0.3);
            }

            .sidebar.show {
                left: 0;
            }

            .main-content {
                padding: 80px 15px 20px;
                width: 100%;
            }

            .content-header h2 {
                font-size: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .license-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .card {
                padding: 20px;
            }

            .mobile-menu-toggle {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1001;
                background: #667eea;
                color: white;
                border: none;
                padding: 12px;
                border-radius: 10px;
                font-size: 18px;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            }

            /* Tablas responsivas en m√≥vil */
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                font-size: 12px;
            }

            table thead {
                display: none;
            }

            table tbody {
                display: block;
            }

            table tbody tr {
                display: block;
                background: white;
                margin-bottom: 15px;
                padding: 15px;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                border-left: 4px solid #667eea;
                position: relative;
            }

            table tbody td {
                display: block;
                border: none;
                padding: 8px 0;
                text-align: left;
                position: relative;
                padding-left: 40%;
            }

            table tbody td:before {
                content: attr(data-label);
                position: absolute;
                left: 0;
                width: 35%;
                font-weight: 700;
                color: #374151;
                text-transform: uppercase;
                font-size: 10px;
                letter-spacing: 1px;
            }

            .license-actions {
                justify-content: center;
                margin-top: 15px;
            }

            .license-actions button {
                font-size: 11px;
                padding: 8px 12px;
            }
        }

        /* Mobile Landscape - 481px a 768px */
        @media (min-width: 481px) and (max-width: 768px) {
            .generator-section .mobile-menu-toggle {
                display: block !important;
            }
            .login-section.active {
                padding: 30px 20px;
                max-width: 450px;
            }

            .login-section .header h1 {
                font-size: 2.5rem;
            }

            #loginForm {
                padding: 40px 30px;
            }

            .dashboard {
                height: auto;
                max-height: none;
            }

            .dashboard {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 20px 15px;
                position: fixed;
                top: 0;
                left: -100%;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
            }

            .sidebar.show {
                left: 0;
            }

            .main-content {
                padding: 80px 25px 25px;
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .license-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }

        /* Tablet - 769px a 1024px */
        @media (min-width: 769px) and (max-width: 1024px) {
            .dashboard {
                height: 100vh;
            }

            .sidebar {
                width: 260px;
            }

            .main-content {
                padding: 30px;
            }

            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .license-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .mobile-menu-toggle {
                display: none;
            }
        }

        /* Desktop Large - m√°s de 1024px */
        @media (min-width: 1025px) {
            .container {
                max-width: 1400px;
            }

            .dashboard {
                height: 100vh;
            }

            .sidebar {
                width: 300px;
            }

            .main-content {
                padding: 40px;
            }

            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .license-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .mobile-menu-toggle {
                display: none;
            }
        }

        /* Desktop Extra Large - m√°s de 1440px */
        @media (min-width: 1441px) {
            .container {
                max-width: 1600px;
            }

            .license-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Responsive utilities */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
            transition: all 0.3s ease;
        }

        .mobile-menu-toggle:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }

        .mobile-menu-toggle:active {
            transform: scale(0.95);
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar-overlay.show {
            display: block;
            opacity: 1;
        }

        /* Mejoras para touch devices */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 48px;
                padding: 16px 24px;
            }

            .nav-link {
                padding: 16px 20px;
                min-height: 48px;
            }

            .form-group input {
                min-height: 48px;
                padding: 16px 20px;
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .license-card {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .license-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .license-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .license-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }

        .license-row strong {
            color: #333;
        }

        .license-key {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border: 2px dashed #ffc107;
            margin: 15px 0;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #856404;
            text-align: center;
            font-size: 16px;
        }

        .licenses-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .license-item {
            background: #f8f9fa;
            border-left: 4px solid #e67e22;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .license-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .license-item.expired {
            border-left-color: #ef4444;
            opacity: 0.7;
        }

        .license-item h4 {
            color: #e67e22;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .license-item p {
            margin: 5px 0;
            font-size: 14px;
            color: #666;
        }

        .logout-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            z-index: 10;
        }

        .logout-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .back-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3);
            z-index: 10;
        }

        .back-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(100, 116, 139, 0.4);
        }

        .license-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn-renovar, .btn-eliminar {
            padding: 8px 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-renovar {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-renovar:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-eliminar {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-eliminar:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .btn-suspender {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .btn-suspender:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        .btn-activar {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .btn-activar:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(6, 182, 212, 0.4);
        }

        .btn-editar {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .btn-editar:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .license-item.suspended {
            border-left-color: #ffc107;
            opacity: 0.6;
            background: #fff3cd;
        }

        /* Estilos de tablas modernas */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        table thead {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            color: white;
        }

        table thead th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        table tbody tr {
            border-bottom: 1px solid #e0e0e0;
            transition: background 0.3s;
        }

        table tbody tr:hover {
            background: #f8f9fa;
        }

        table tbody td {
            padding: 12px 15px;
            font-size: 14px;
            color: #333;
        }

        table tbody tr:last-child {
            border-bottom: none;
        }

        .licenses-table {
            margin-top: 20px;
            overflow-x: auto;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-expired {
            background: #f8d7da;
            color: #721c24;
        }

        .status-suspended {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <button id="backBtn" class="back-btn" style="display: none;" onclick="volverLogin()">‚Üê Volver</button>
        <button id="logoutBtn" class="logout-btn" style="display: none;" onclick="cerrarSesion()">Cerrar Sesi√≥n</button>
        
        <!-- Login Section -->
        <div id="loginSection" class="login-section active">
            <div class="header">
                <h1>üîê Generador de Licencias</h1>
                <p>Sistema de Gesti√≥n de Taller - Administrador</p>
            </div>

            <div id="loginError" style="display: none;" class="alert alert-error"></div>

            <form id="loginForm" onsubmit="iniciarSesion(event)">
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" required autocomplete="username" placeholder="Ingresa tu usuario administrativo">
                </div>

                <div class="form-group">
                    <label for="password">Contrase√±a</label>
                    <input type="password" id="password" required autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>

                <button type="submit" class="btn btn-primary">Acceder al Sistema</button>
            </form>
        </div>

        <!-- Dashboard Section -->
        <div id="generatorSection" class="generator-section">
            <!-- Mobile menu toggle -->
            <button class="mobile-menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
            
            <!-- Sidebar overlay for mobile -->
            <div class="sidebar-overlay" onclick="closeSidebar()"></div>
            
            <div class="dashboard">
                <!-- Sidebar -->
                <div class="sidebar">
                    <div class="sidebar-header">
                        <h1>üîê Tu Taller</h1>
                        <p>Sistema de Licencias</p>
                    </div>
                    
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <div class="nav-link active" onclick="showSection('generator')">
                                <span class="nav-icon">‚öôÔ∏è</span>
                                Generar Licencias
                            </div>
                        </li>
                        <li class="nav-item">
                            <div class="nav-link" onclick="showSection('licenses')">
                                <span class="nav-icon">üìã</span>
                                Licencias Activas
                            </div>
                        </li>
                        <li class="nav-item">
                            <div class="nav-link" onclick="showSection('users')">
                                <span class="nav-icon">üë•</span>
                                Usuarios
                            </div>
                        </li>
                        <li class="nav-item">
                            <div class="nav-link" onclick="showSection('statistics')">
                                <span class="nav-icon">üìä</span>
                                Estad√≠sticas
                            </div>
                        </li>
                        <li class="nav-item" style="margin-top: auto;">
                            <div class="nav-link" onclick="cerrarSesion()">
                                <span class="nav-icon">üö™</span>
                                Cerrar Sesi√≥n
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Main Content -->
                <div class="main-content">
                    <!-- Generator Section -->
                    <div id="section-generator" class="content-section">
                        <div class="content-header">
                            <h2>‚öôÔ∏è Generar Nueva Licencia</h2>
                            <p>Crea licencias personalizadas para tus clientes</p>
                        </div>

                        <div id="successMessage" style="display: none;" class="alert alert-success"></div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span class="card-icon">üìù</span>
                                    Datos del Cliente
                                </h3>
                            </div>
                            
                            <form id="licenseForm" onsubmit="generarLicencia(event)">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="clientName">Nombre del Cliente/Taller</label>
                                        <input type="text" id="clientName" required placeholder="Ej: Taller TecnoCell">
                                    </div>

                                    <div class="form-group">
                                        <label for="clientEmail">Email del Cliente</label>
                                        <input type="email" id="clientEmail" required placeholder="ejemplo@correo.com">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="licenseType">Tipo de Licencia</label>
                                        <select id="licenseType">
                                            <option value="prueba">üîç Prueba - 3 d√≠as</option>
                                            <option value="mensual">üìÖ Mensual - 30 d√≠as</option>
                                            <option value="trimestral">üóìÔ∏è Trimestral - 90 d√≠as</option>
                                            <option value="semestral">üìÜ Semestral - 180 d√≠as</option>
                                            <option value="anual">üéØ Anual - 365 d√≠as</option>
                                            <option value="vitalicia">‚ôæÔ∏è Vitalicia - Sin expiraci√≥n</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="maxDevices">M√°ximo de Dispositivos</label>
                                        <input type="number" id="maxDevices" value="1" min="1" max="10" required>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary">
                                    ‚öôÔ∏è Generar Licencia
                                </button>
                            </form>
                        </div>

                        <div id="licenseResult" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <span class="card-icon">‚úÖ</span>
                                        Licencia Generada Exitosamente
                                    </h3>
                                </div>
                                <div class="license-info" id="licenseDetails"></div>
                                <div class="license-key" id="licenseKeyDisplay"></div>
                                <div style="display: flex; gap: 12px; margin-top: 20px;">
                                    <button class="btn btn-success" onclick="copiarLicencia()">üìã Copiar</button>
                                    <button class="btn btn-secondary" onclick="descargarLicencia()">üíæ Descargar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Licenses Section -->
                    <div id="section-licenses" class="content-section" style="display: none;">
                        <div class="content-header">
                            <h2>üìã Licencias Activas</h2>
                            <p>Administra todas las licencias del sistema</p>
                        </div>
                        <div class="card">
                            <div id="licensesList"></div>
                        </div>
                    </div>

                    <!-- Users Section -->
                    <div id="section-users" class="content-section" style="display: none;">
                        <div class="content-header">
                            <h2>üë• Administraci√≥n de Usuarios</h2>
                            <p>Gestiona los usuarios registrados y resetea contrase√±as</p>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span class="card-icon">üë§</span>
                                    Lista de Usuarios
                                </h3>
                                <button class="btn btn-primary" onclick="cargarUsuarios()">
                                    üîÑ Actualizar
                                </button>
                            </div>
                            <div id="usuariosList"></div>
                        </div>
                    </div>

                    <!-- Statistics Section -->
                    <div id="section-statistics" class="content-section" style="display: none;">
                        <div class="content-header">
                            <h2>üìä Panel de Estad√≠sticas</h2>
                            <p>M√©tricas y an√°lisis del sistema</p>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="totalLicenses">0</div>
                                <div class="stat-label">Total Licencias</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="totalUsers">0</div>
                                <div class="stat-label">Usuarios Registrados</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="activeLicenses">0</div>
                                <div class="stat-label">Licencias Activas</div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span class="card-icon">üìà</span>
                                    Resumen General
                                </h3>
                            </div>
                            <div id="statisticsContent">
                                <p>Las estad√≠sticas se cargan autom√°ticamente...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CREDENCIALES = {
            usuario: 'admin_licencias',
            password: 'SecurePass2025!'
        };

        // Verificar si hay sesi√≥n activa al cargar
        window.addEventListener('DOMContentLoaded', () => {
            const sesionActiva = localStorage.getItem('licenciasSession');
            if (sesionActiva === 'activa') {
                mostrarGenerador();
            } else {
                // Si no hay sesi√≥n activa, mostrar login
                document.body.classList.add('login-mode');
            }
        });

        function iniciarSesion(event) {
            event.preventDefault();
            const usuario = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (usuario === 'admin_licencias' && password === 'SecurePass2025!') {
                localStorage.setItem('licenciasSession', 'activa');
                mostrarGenerador();
                return;
            }
            
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = '‚ùå Usuario o contrase√±a incorrectos';
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function cerrarSesion() {
            localStorage.removeItem('licenciasSession');
            document.getElementById('loginSection').classList.add('active');
            document.getElementById('generatorSection').classList.remove('active');
            document.body.classList.remove('dashboard-mode');
            document.body.classList.add('login-mode');
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('backBtn').style.display = 'none';
            document.getElementById('loginForm').reset();
        }

        function volverLogin() {
            if (confirm('¬øDeseas volver al login? No se cerrar√° tu sesi√≥n.')) {
                document.getElementById('loginSection').classList.add('active');
                document.getElementById('generatorSection').classList.remove('active');
                document.body.classList.remove('dashboard-mode');
                document.body.classList.add('login-mode');
                document.getElementById('logoutBtn').style.display = 'none';
                document.getElementById('backBtn').style.display = 'none';
            }
        }

        function mostrarGenerador() {
            document.getElementById('loginSection').classList.remove('active');
            document.getElementById('generatorSection').classList.add('active');
            document.body.classList.remove('login-mode');
            document.body.classList.add('dashboard-mode');
            showSection('generator');
            cargarLicencias();
        }

        function showSection(sectionName) {
            // Ocultar todas las secciones
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.style.display = 'none');
            
            // Remover clase active de todos los nav-links
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            
            // Mostrar secci√≥n seleccionada
            const targetSection = document.getElementById('section-' + sectionName);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // Agregar clase active al nav-link correspondiente
            const activeNavLink = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
            if (activeNavLink) {
                activeNavLink.classList.add('active');
            }
            
            // Cargar datos espec√≠ficos seg√∫n la secci√≥n
            if (sectionName === 'licenses') {
                cargarLicencias();
            } else if (sectionName === 'users') {
                cargarUsuarios();
            } else if (sectionName === 'statistics') {
                cargarEstadisticas();
            }

            // Cerrar sidebar en m√≥vil despu√©s de seleccionar secci√≥n
            closeSidebar();
        }

        // Funciones para el men√∫ m√≥vil
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            if (sidebar && overlay) {
                sidebar.classList.toggle('show');
                overlay.classList.toggle('show');
                
                // Prevenir scroll del body cuando el men√∫ est√° abierto
                if (sidebar.classList.contains('show')) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = '';
                }
            }
        }

        function closeSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            if (sidebar && overlay) {
                sidebar.classList.remove('show');
                overlay.classList.remove('show');
                document.body.style.overflow = '';
            }
        }

        // Cerrar sidebar al hacer clic en enlaces de navegaci√≥n en m√≥vil
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        setTimeout(closeSidebar, 100);
                    }
                });
            });

            // Cerrar sidebar al redimensionar ventana
            window.addEventListener('resize', () => {
                if (window.innerWidth > 768) {
                    closeSidebar();
                }
            });

            // Agregar funcionalidad de swipe para cerrar el men√∫
            let startX = 0;
            const sidebar = document.querySelector('.sidebar');
            
            if (sidebar) {
                sidebar.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                }, { passive: true });
                
                sidebar.addEventListener('touchend', (e) => {
                    const endX = e.changedTouches[0].clientX;
                    const diffX = startX - endX;
                    
                    // Si se hace swipe hacia la izquierda, cerrar men√∫
                    if (diffX > 50) {
                        closeSidebar();
                    }
                }, { passive: true });
            }
        });

        function cargarEstadisticas() {
            // Obtener estad√≠sticas del sistema
            const licenciasLocal = JSON.parse(localStorage.getItem('licenciasGeneradas') || '[]');
            const usuariosLocal = JSON.parse(localStorage.getItem('usuariosRegistrados') || '[]');
            
            document.getElementById('totalLicenses').textContent = licenciasLocal.length;
            document.getElementById('totalUsers').textContent = usuariosLocal.length;
            
            // Calcular licencias activas (no vencidas)
            const ahora = new Date();
            const licenciasActivas = licenciasLocal.filter(lic => {
                if (lic.type === 'vitalicia') return true;
                const expiracion = new Date(lic.expirationDate);
                return expiracion > ahora;
            });
            
            document.getElementById('activeLicenses').textContent = licenciasActivas.length;
            
            // Generar contenido de estad√≠sticas
            let estadisticasHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 10px;">üìã Por Tipo de Licencia</h4>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
            `;
            
            const tiposLicencia = {};
            licenciasLocal.forEach(lic => {
                tiposLicencia[lic.type] = (tiposLicencia[lic.type] || 0) + 1;
            });
            
            Object.entries(tiposLicencia).forEach(([tipo, cantidad]) => {
                estadisticasHTML += `<p><strong>${tipo}:</strong> ${cantidad}</p>`;
            });
            
            estadisticasHTML += `
                        </div>
                    </div>
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 10px;">üìä Estado General</h4>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                            <p><strong>Licencias Vencidas:</strong> ${licenciasLocal.length - licenciasActivas.length}</p>
                            <p><strong>Dispositivos M√°ximos:</strong> ${licenciasLocal.reduce((acc, lic) => acc + (lic.maxDevices || 1), 0)}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('statisticsContent').innerHTML = estadisticasHTML;
        }

        async function generarLicencia(event) {
            event.preventDefault();

            const clientName = document.getElementById('clientName').value;
            const clientEmail = document.getElementById('clientEmail').value;
            const licenseType = document.getElementById('licenseType').value;
            const maxDevices = parseInt(document.getElementById('maxDevices').value);

            // Calcular fecha de expiraci√≥n
            const fechaCreacion = new Date();
            let fechaExpiracion = null;
            let dias = 0;

            switch (licenseType) {
                case 'prueba': dias = 3; break;
                case 'mensual': dias = 30; break;
                case 'trimestral': dias = 90; break;
                case 'semestral': dias = 180; break;
                case 'anual': dias = 365; break;
                case 'vitalicia': dias = 0; break;
            }

            if (dias > 0) {
                fechaExpiracion = new Date();
                fechaExpiracion.setDate(fechaExpiracion.getDate() + dias);
            }

            // Generar c√≥digo de licencia √∫nico
            const licenseKey = generarCodigoLicencia(clientName, licenseType);

            const licencia = {
                clientName,
                clientEmail,
                licenseType,
                licenseKey,
                maxDevices,
                fechaCreacion: fechaCreacion.toISOString(),
                fechaExpiracion: fechaExpiracion ? fechaExpiracion.toISOString() : null,
                activa: true,
                suspendida: false
            };

            try {
                // Guardar licencia en Firebase
                await db.collection('licencias').add(licencia);
                
                // Tambi√©n guardar en localStorage como respaldo
                let licencias = JSON.parse(localStorage.getItem('licenciasGeneradas') || '[]');
                licencias.unshift(licencia);
                localStorage.setItem('licenciasGeneradas', JSON.stringify(licencias));

                // Mostrar resultado
                mostrarResultado(licencia);
                await cargarLicencias();

                // Limpiar formulario
                document.getElementById('licenseForm').reset();
                
                alert('‚úÖ Licencia generada y guardada en Firebase correctamente');
            } catch (error) {
                console.error('Error al generar licencia:', error);
                alert('‚ùå Error al guardar licencia. Por favor intenta de nuevo.');
            }
        }

        function generarCodigoLicencia(nombre, tipo) {
            const prefijo = tipo.substring(0, 3).toUpperCase();
            const nombreHash = btoa(nombre).substring(0, 8).toUpperCase().replace(/[^A-Z0-9]/g, '');
            const timestamp = Date.now().toString(36).toUpperCase();
            const random = Math.random().toString(36).substring(2, 6).toUpperCase();
            
            return `TT-${prefijo}-${nombreHash}-${timestamp}-${random}`;
        }

        function mostrarResultado(licencia) {
            const resultDiv = document.getElementById('licenseResult');
            const detailsDiv = document.getElementById('licenseDetails');
            const keyDisplay = document.getElementById('licenseKeyDisplay');

            const tipoTexto = {
                prueba: 'Prueba (3 d√≠as)',
                mensual: 'Mensual (30 d√≠as)',
                trimestral: 'Trimestral (90 d√≠as)',
                semestral: 'Semestral (180 d√≠as)',
                anual: 'Anual (365 d√≠as)',
                vitalicia: 'Vitalicia (Sin expiraci√≥n)'
            };

            detailsDiv.innerHTML = `
                <div class="license-row">
                    <strong>Cliente:</strong>
                    <span>${licencia.clientName}</span>
                </div>
                <div class="license-row">
                    <strong>Email:</strong>
                    <span>${licencia.clientEmail}</span>
                </div>
                <div class="license-row">
                    <strong>Tipo:</strong>
                    <span>${tipoTexto[licencia.licenseType]}</span>
                </div>
                <div class="license-row">
                    <strong>Dispositivos:</strong>
                    <span>${licencia.maxDevices}</span>
                </div>
                <div class="license-row">
                    <strong>Fecha Creaci√≥n:</strong>
                    <span>${new Date(licencia.fechaCreacion).toLocaleDateString()}</span>
                </div>
                ${licencia.fechaExpiracion ? `
                <div class="license-row">
                    <strong>Fecha Expiraci√≥n:</strong>
                    <span>${new Date(licencia.fechaExpiracion).toLocaleDateString()}</span>
                </div>
                ` : ''}
            `;

            keyDisplay.textContent = licencia.licenseKey;
            resultDiv.style.display = 'block';

            // Scroll al resultado
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        async function cargarLicencias() {
            const container = document.getElementById('licensesList');
            
            // Mostrar loading mientras carga
            container.innerHTML = '<p style="text-align: center; padding: 20px;">üîÑ Cargando licencias...</p>';
            
            try {
                // Cargar licencias desde localStorage
                const licenciasLocal = JSON.parse(localStorage.getItem('licenciasGeneradas') || '[]');
                
                // Cargar licencias desde Firebase
                const licenciasFirebase = [];
                
                // Verificar si Firebase est√° inicializado
                if (!window.firebase || !db) {
                    throw new Error('Firebase no est√° inicializado correctamente');
                }
                
                const snapshot = await db.collection('licencias')
                    .orderBy('fechaCreacion', 'desc')
                    .get();
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    licenciasFirebase.push({
                        id: doc.id,
                        ...data,
                        origen: 'Firebase'
                    });
                });

                // Combinar licencias √∫nicas (priorizar Firebase)
                const todasLicencias = [...licenciasFirebase];
                licenciasLocal.forEach(licLocal => {
                    const existeEnFirebase = licenciasFirebase.find(licFB => licFB.licenseKey === licLocal.licenseKey);
                    if (!existeEnFirebase) {
                        todasLicencias.push({
                            ...licLocal,
                            origen: 'Local'
                        });
                    }
                });
                
                if (todasLicencias.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No hay licencias generadas</p>';
                    return;
                }

                const tipoTexto = {
                    prueba: 'Prueba',
                    mensual: 'Mensual',
                    trimestral: 'Trimestral',
                    semestral: 'Semestral',
                    anual: 'Anual',
                    vitalicia: 'Vitalicia'
                };

                // Obtener usuarios registrados desde localStorage (solo para info)
                const usuariosRegistrados = JSON.parse(localStorage.getItem('usuariosRegistrados') || '[]');
                
                // Generar HTML con estad√≠sticas
                let html = `
                    <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px;">
                        üìä <strong>Total de licencias:</strong> ${todasLicencias.length} 
                        | üî• Firebase: ${licenciasFirebase.length} 
                        | üíæ Local: ${todasLicencias.length - licenciasFirebase.length}
                    </div>
                `;
            
                html += todasLicencias.map((lic, index) => {
                    const expirada = lic.fechaExpiracion && new Date(lic.fechaExpiracion) < new Date();
                    const suspendida = lic.suspendida === true;
                    let estado = '‚úÖ ACTIVA';
                    let claseEstado = '';
                    
                    if (suspendida) {
                        estado = '‚è∏Ô∏è SUSPENDIDA';
                        claseEstado = 'suspended';
                    } else if (expirada) {
                        estado = '‚ùå EXPIRADA';
                        claseEstado = 'expired';
                    }
                    
                    // Buscar usuario registrado con esta licencia
                    const usuarioRegistrado = usuariosRegistrados.find(u => u.licenseKey === lic.licenseKey);
                    const origen = lic.origen || 'Desconocido';
                    
                    return `
                        <div class="license-item ${claseEstado}" style="margin-bottom: 15px; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 4px solid #667eea;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                <div>
                                    <h4 style="margin: 0 0 8px 0; color: #1e293b; font-size: 1.1em;">${lic.clientName}</h4>
                                    <span style="padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; ${estado.includes('ACTIVA') ? 'background: #dcfce7; color: #166534;' : estado.includes('SUSPENDIDA') ? 'background: #fef3c7; color: #92400e;' : 'background: #fee2e2; color: #b91c1c;'}">${estado}</span>
                                </div>
                                <span style="padding: 2px 6px; border-radius: 3px; font-size: 10px; background: ${origen === 'Firebase' ? '#e8f5e8; color: #2e7d32' : '#fff3e0; color: #ef6c00'}">${origen}</span>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <p style="margin: 4px 0; font-size: 14px;"><strong>üìß Email:</strong> ${lic.clientEmail}</p>
                                    <p style="margin: 4px 0; font-size: 14px;"><strong>üéØ Tipo:</strong> ${tipoTexto[lic.licenseType] || lic.type}</p>
                                    <p style="margin: 4px 0; font-size: 14px;"><strong>üì± Dispositivos:</strong> ${lic.maxDevices || 1}</p>
                                </div>
                                <div>
                                    <p style="margin: 4px 0; font-size: 14px;"><strong>üìÖ Creada:</strong> ${new Date(lic.fechaCreacion || lic.creationDate).toLocaleDateString()}</p>
                                    ${lic.fechaExpiracion || lic.expirationDate ? `<p style="margin: 4px 0; font-size: 14px;"><strong>‚è∞ Expira:</strong> ${new Date(lic.fechaExpiracion || lic.expirationDate).toLocaleDateString()}</p>` : '<p style="margin: 4px 0; font-size: 14px;"><strong>‚ôæÔ∏è Sin expiraci√≥n</strong></p>'}
                                </div>
                            </div>

                            <div style="background: #f8fafc; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                                <p style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; color: #374151;">üîë Clave de Licencia:</p>
                                <p style="margin: 0; font-family: 'Courier New', monospace; background: white; padding: 8px; border-radius: 4px; border: 1px solid #e5e7eb; word-break: break-all; font-size: 12px;">${lic.licenseKey}</p>
                            </div>

                            ${usuarioRegistrado ? `
                                <div style="background: #f0fdf4; border: 1px solid #bbf7d0; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                                    <p style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; color: #166534;">‚úÖ Licencia Activada</p>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                        <p style="margin: 4px 0; font-size: 12px;"><strong>üë§ Usuario:</strong> <span style="font-family: monospace; color: #059669;">${usuarioRegistrado.usuario}</span></p>
                                        <p style="margin: 4px 0; font-size: 12px;"><strong>üîë Contrase√±a:</strong> <span style="font-family: monospace; color: #059669;">${usuarioRegistrado.password}</span></p>
                                    </div>
                                    <p style="margin: 4px 0 0 0; font-size: 12px; color: #065f46;">üìÖ Activada el ${new Date(usuarioRegistrado.fechaRegistro || Date.now()).toLocaleDateString()}</p>
                                </div>
                            ` : `
                                <div style="background: #fafafa; border: 1px solid #e5e7eb; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                                    <p style="margin: 0; font-size: 13px; color: #6b7280;">‚ö™ Licencia no activada - Sin usuario registrado</p>
                                </div>
                            `}

                            <div class="license-actions" style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="btn-editar" onclick="editarLicenciaFirebase('${lic.licenseKey}').then(r => r && cargarLicencias())" style="padding: 6px 12px; font-size: 12px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer;">‚úèÔ∏è Editar</button>
                                <button class="btn-renovar" onclick="renovarLicenciaFirebase('${lic.licenseKey}').then(r => r && cargarLicencias())" style="padding: 6px 12px; font-size: 12px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">üîÑ Renovar</button>
                                ${suspendida ? 
                                    `<button class="btn-activar" onclick="toggleSuspenderLicenciaFirebase('${lic.licenseKey}').then(r => r && cargarLicencias())" style="padding: 6px 12px; font-size: 12px; background: #22c55e; color: white; border: none; border-radius: 6px; cursor: pointer;">‚ñ∂Ô∏è Activar</button>` :
                                    `<button class="btn-suspender" onclick="toggleSuspenderLicenciaFirebase('${lic.licenseKey}').then(r => r && cargarLicencias())" style="padding: 6px 12px; font-size: 12px; background: #f97316; color: white; border: none; border-radius: 6px; cursor: pointer;">‚è∏Ô∏è Suspender</button>`
                                }
                                <button class="btn-eliminar" onclick="eliminarLicenciaFirebase('${lic.licenseKey}').then(r => r && cargarLicencias())" style="padding: 6px 12px; font-size: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer;">üóëÔ∏è Eliminar</button>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error al cargar licencias:', error);
                container.innerHTML = `
                    <div style="text-align: center; color: #dc3545; padding: 20px; background: #fff5f5; border-radius: 6px; border: 1px solid #fed7d7;">
                        <h4>‚ùå Error al cargar licencias</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <button onclick="cargarLicencias()" style="margin-top: 10px; padding: 6px 12px;">üîÑ Reintentar</button>
                    </div>
                `;
            }
        }

        function copiarLicencia() {
            const licenseKey = document.getElementById('licenseKeyDisplay').textContent;
            navigator.clipboard.writeText(licenseKey).then(() => {
                alert('‚úÖ Licencia copiada al portapapeles');
            });
        }

        // ====== ADMINISTRACI√ìN DE USUARIOS ======

        async function cargarUsuarios() {
            const container = document.getElementById('usuariosList');
            
            // Mostrar loading mientras carga
            container.innerHTML = '<p style="text-align: center; padding: 20px;">üîÑ Cargando usuarios...</p>';
            
            try {
                // Cargar usuarios desde localStorage
                const usuariosLocal = JSON.parse(localStorage.getItem('usuariosRegistrados') || '[]');
                
                // Cargar usuarios desde Firebase
                const usuariosFirebase = [];
                const usuariosGoogle = [];
                
                // Verificar si Firebase est√° inicializado
                if (!window.firebase || !db) {
                    throw new Error('Firebase no est√° inicializado correctamente');
                }
                
                // Usuarios normales de Firebase
                const usuariosSnapshot = await db.collection('usuarios').get();
                usuariosSnapshot.forEach(doc => {
                    const data = doc.data();
                    usuariosFirebase.push({
                        id: doc.id,
                        usuario: data.usuario,
                        email: data.email,
                        licenseKey: data.licenseKey,
                        fechaCreacion: data.fechaCreacion,
                        origen: 'Firebase'
                    });
                });

                // Usuarios de Google
                const googleSnapshot = await db.collection('usuarios-google').get();
                googleSnapshot.forEach(doc => {
                    const data = doc.data();
                    usuariosGoogle.push({
                        id: doc.id,
                        usuario: data.nombre || data.email.split('@')[0],
                        email: data.email,
                        licenseKey: 'Google Auth',
                        fechaCreacion: data.fechaRegistro,
                        ultimoAcceso: data.ultimoAcceso,
                        foto: data.foto,
                        proveedor: 'Google',
                        origen: 'Google'
                    });
                });

                // Combinar usuarios √∫nicos (priorizar Firebase, luego Google, luego Local)
                const todosUsuarios = [...usuariosFirebase, ...usuariosGoogle];
                usuariosLocal.forEach(userLocal => {
                    const existeEnFirebase = usuariosFirebase.find(userFB => userFB.usuario === userLocal.usuario);
                    const existeEnGoogle = usuariosGoogle.find(userG => userG.email === userLocal.email);
                    if (!existeEnFirebase && !existeEnGoogle) {
                        todosUsuarios.push({
                            ...userLocal,
                            origen: 'Local'
                        });
                    }
                });
                
                if (todosUsuarios.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No hay usuarios registrados</p>';
                    return;
                }

                // Obtener datos de licencias para mostrar informaci√≥n adicional
                const licenciasSnapshot = await db.collection('licencias').get();
                const licenciasMap = {};
                licenciasSnapshot.forEach(doc => {
                    licenciasMap[doc.data().licenseKey] = doc.data();
                });

                // Crear tabla de usuarios
                let html = '<table><thead><tr><th>Usuario</th><th>Email</th><th>Licencia/Tipo</th><th>Origen</th><th>Fecha</th><th>Nueva Contrase√±a</th><th>Acciones</th></tr></thead><tbody>';

                todosUsuarios.forEach((usuario, index) => {
                    const licencia = licenciasMap[usuario.licenseKey];
                    let clienteName = 'Sin informaci√≥n';
                    let tipoUsuario = '';
                    
                    if (usuario.origen === 'Google') {
                        clienteName = 'Google Authentication';
                        tipoUsuario = 'üîç Google';
                    } else {
                        clienteName = licencia ? licencia.clientName : 'Sin informaci√≥n';
                        tipoUsuario = 'üîë Licencia';
                    }
                    
                    const fechaCreacion = usuario.fechaCreacion || usuario.ultimoAcceso || 'No disponible';
                    const origen = usuario.origen || 'Desconocido';
                    
                    // Colores por origen
                    let origenStyle = '';
                    if (origen === 'Google') {
                        origenStyle = '#e3f2fd; color: #1565c0'; // Azul Google
                    } else if (origen === 'Firebase') {
                        origenStyle = '#e8f5e8; color: #2e7d32'; // Verde Firebase
                    } else {
                        origenStyle = '#fff3e0; color: #ef6c00'; // Naranja Local
                    }
                    
                    // Mostrar foto de perfil para usuarios de Google
                    const userIcon = usuario.foto ? 
                        `<img src="${usuario.foto}" alt="Foto" style="width: 24px; height: 24px; border-radius: 50%; margin-right: 8px; vertical-align: middle;">` : 
                        '';
                    
                    html += `
                        <tr>
                            <td data-label="Usuario">${userIcon}<strong>${usuario.usuario}</strong></td>
                            <td data-label="Email">${usuario.email || '-'}</td>
                            <td data-label="Licencia">${tipoUsuario} ${clienteName}</td>
                            <td data-label="Origen"><span style="padding: 2px 6px; border-radius: 3px; font-size: 10px; background: ${origenStyle}">${origen}</span></td>
                            <td data-label="Fecha" style="font-size: 11px;">${fechaCreacion}</td>
                            <td data-label="Nueva Contrase√±a">
                                ${usuario.origen === 'Google' ? 
                                    '<span style="color: #999; font-size: 11px;">üîí Google Auth</span>' :
                                    `<input type="text" id="newPass_${index}" placeholder="Nueva contrase√±a" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">`
                                }
                            </td>
                            <td data-label="Acciones">
                                <div class="license-actions" style="gap: 8px;">
                                    ${usuario.origen === 'Google' ? 
                                        `<button class="btn-secondary" style="padding: 6px 10px; font-size: 11px;" disabled>üîí Google</button>` :
                                        `<button class="btn-editar" onclick="resetearContrasena(${index}, '${usuario.usuario}')" style="padding: 6px 10px; font-size: 11px;">Resetear</button>`
                                    }
                                    <button class="btn-eliminar" onclick="eliminarUsuario(${index}, '${usuario.usuario}', '${origen}')" style="padding: 6px 10px; font-size: 11px;">Eliminar</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                
                // Mostrar estad√≠sticas
                const usuariosLocales = todosUsuarios.length - usuariosFirebase.length - usuariosGoogle.length;
                const statsHtml = `
                    <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px;">
                        üìä <strong>Total de usuarios:</strong> ${todosUsuarios.length} 
                        | üî• Firebase: ${usuariosFirebase.length} 
                        | üîç Google: ${usuariosGoogle.length}
                        | üíæ Local: ${usuariosLocales}
                    </div>
                `;
                
                const finalHtml = statsHtml + html;
                container.innerHTML = finalHtml;

            } catch (error) {
                console.error('Error al cargar usuarios:', error);
                container.innerHTML = `
                    <div style="text-align: center; color: #dc3545; padding: 20px; background: #fff5f5; border-radius: 6px; border: 1px solid #fed7d7;">
                        <h4>‚ùå Error al cargar usuarios</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <button onclick="cargarUsuarios()" style="margin-top: 10px; padding: 6px 12px;">üîÑ Reintentar</button>
                    </div>
                `;
            }
        }

        async function resetearContrasena(index, nombreUsuario) {
            const nuevaPass = document.getElementById(`newPass_${index}`).value;
            
            if (!nuevaPass || nuevaPass.trim().length < 4) {
                alert('‚ùå Ingresa una contrase√±a de al menos 4 caracteres');
                return;
            }

            if (!confirm(`¬øEst√°s seguro de resetear la contrase√±a de ${nombreUsuario} a "${nuevaPass}"?`)) {
                return;
            }

            try {
                // Obtener usuarios del localStorage
                const usuariosLocal = JSON.parse(localStorage.getItem('usuariosRegistrados') || '[]');
                
                if (index >= 0 && index < usuariosLocal.length) {
                    usuariosLocal[index].password = nuevaPass;
                    usuariosLocal[index].fechaReseteo = new Date().toISOString();
                    
                    // Guardar en localStorage
                    localStorage.setItem('usuariosRegistrados', JSON.stringify(usuariosLocal));
                    
                    // Tambi√©n guardar en Firebase en una colecci√≥n de usuarios
                    const usuarioFirebase = {
                        usuario: usuariosLocal[index].usuario,
                        email: usuariosLocal[index].email,
                        password: nuevaPass,
                        licenseKey: usuariosLocal[index].licenseKey,
                        fechaCreacion: usuariosLocal[index].fechaCreacion,
                        fechaReseteo: new Date().toISOString(),
                        resetadoPor: 'admin',
                        estado: 'activo'
                    };

                    // Buscar si ya existe el usuario en Firebase
                    const snapshot = await db.collection('usuarios')
                        .where('usuario', '==', usuariosLocal[index].usuario)
                        .get();

                    if (snapshot.empty) {
                        // Crear nuevo documento
                        await db.collection('usuarios').add(usuarioFirebase);
                    } else {
                        // Actualizar documento existente
                        await snapshot.docs[0].ref.update(usuarioFirebase);
                    }

                    alert(`‚úÖ Contrase√±a actualizada correctamente\n\nUsuario: ${nombreUsuario}\nNueva contrase√±a: ${nuevaPass}`);
                    document.getElementById(`newPass_${index}`).value = '';
                    await cargarUsuarios();
                }
            } catch (error) {
                console.error('Error al resetear contrase√±a:', error);
                alert('‚ùå Error al actualizar la contrase√±a');
            }
        }

        async function eliminarUsuario(index, nombreUsuario) {
            if (!confirm(`¬øEst√°s seguro de eliminar al usuario ${nombreUsuario}?\n\nEsta acci√≥n no se puede deshacer.`)) {
                return;
            }

            try {
                const usuariosLocal = JSON.parse(localStorage.getItem('usuariosRegistrados') || '[]');
                
                if (index >= 0 && index < usuariosLocal.length) {
                    const usuarioAEliminar = usuariosLocal[index];
                    usuariosLocal.splice(index, 1);
                    
                    // Guardar cambios en localStorage
                    localStorage.setItem('usuariosRegistrados', JSON.stringify(usuariosLocal));
                    
                    // Eliminar de Firebase
                    const snapshot = await db.collection('usuarios')
                        .where('usuario', '==', usuarioAEliminar.usuario)
                        .get();

                    snapshot.forEach(doc => {
                        doc.ref.delete();
                    });

                    alert('‚úÖ Usuario eliminado correctamente');
                    await cargarUsuarios();
                }
            } catch (error) {
                console.error('Error al eliminar usuario:', error);
                alert('‚ùå Error al eliminar el usuario');
            }
        }

        function descargarLicencia() {
            const licencias = JSON.parse(localStorage.getItem('licenciasGeneradas') || '[]');
            const ultimaLicencia = licencias[0];

            const contenido = `
TU TALLER - SISTEMA DE GESTI√ìN
================================
LICENCIA DE SOFTWARE
================================

Cliente: ${ultimaLicencia.clientName}
Email: ${ultimaLicencia.clientEmail}
Tipo de Licencia: ${ultimaLicencia.licenseType}
M√°ximo de Dispositivos: ${ultimaLicencia.maxDevices}

CLAVE DE LICENCIA:
${ultimaLicencia.licenseKey}

Fecha de Creaci√≥n: ${new Date(ultimaLicencia.fechaCreacion).toLocaleString()}
${ultimaLicencia.fechaExpiracion ? `Fecha de Expiraci√≥n: ${new Date(ultimaLicencia.fechaExpiracion).toLocaleString()}` : 'Sin fecha de expiraci√≥n'}

================================
INSTRUCCIONES DE ACTIVACI√ìN
================================

1. Abra el sistema "Tu Taller"
2. Haga clic en "Activar Licencia"
3. Ingrese la clave de licencia
4. Complete el registro con su usuario y contrase√±a
5. Inicie sesi√≥n con sus credenciales

Para soporte t√©cnico, contacte a:
soporte@tutaller.com

¬© ${new Date().getFullYear()} Tu Taller - Todos los derechos reservados
            `;

            const blob = new Blob([contenido], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Licencia_${ultimaLicencia.clientName.replace(/\s+/g, '_')}_${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
    
    <!-- Environment Variables -->
    <script src="env.js"></script>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-licencias.js"></script>
</body>
</html>
