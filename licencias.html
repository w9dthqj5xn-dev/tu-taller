<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Licencias - Tu Taller</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* Cuando solo el login est√° visible */
        body.login-mode {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Cuando el dashboard est√° activo */
        body.dashboard-mode {
            background: #f8fafc;
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(102, 126, 234, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.8);
            width: 100%;
            max-width: 1200px;
            padding: 0;
            animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .dashboard {
            display: flex;
            height: 100vh;
            max-height: 900px;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            padding: 30px 20px;
            color: white;
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .sidebar-header h1 {
            font-size: 1.8em;
            font-weight: 800;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .sidebar-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            font-weight: 500;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateX(4px);
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 1.2em;
        }

        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f8fafc;
        }

        .content-header {
            margin-bottom: 30px;
        }

        .content-header h2 {
            font-size: 2em;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .content-header p {
            color: #64748b;
            font-size: 16px;
        }

        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 24px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f1f5f9;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
        }

        .card-icon {
            margin-right: 12px;
            font-size: 1.5em;
            color: #667eea;
        }

        .login-section, .generator-section {
            display: none;
        }

        .login-section.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            max-width: 420px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .generator-section.active {
            display: block;
        }

        .login-section .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease-out;
        }

        .login-section .header h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 16px;
            line-height: 1.1;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
            text-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .login-section .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            margin: 0;
            font-weight: 500;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        #loginForm {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 50px 40px;
            border-radius: 30px;
            box-shadow: 
                0 25px 50px rgba(102, 126, 234, 0.15),
                0 8px 32px rgba(118, 75, 162, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.8s ease-out 0.2s both;
            width: 100%;
        }

        #loginForm::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        .form-group {
            margin-bottom: 32px;
            position: relative;
        }

        .form-group label {
            display: block;
            color: #1f2937;
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            padding-left: 32px;
        }

        .form-group label::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background-size: contain;
            opacity: 0.7;
        }

        .form-group:first-of-type label::before {
            content: 'üë§';
            font-size: 16px;
        }

        .form-group:last-of-type label::before {
            content: 'üîí';
            font-size: 16px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 16px;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(248, 250, 252, 0.8);
            backdrop-filter: blur(10px);
            color: #1f2937;
            box-sizing: border-box;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 
                0 0 0 4px rgba(102, 126, 234, 0.15),
                0 8px 25px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .form-group input::placeholder {
            color: #9ca3af;
            font-style: italic;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid #667eea;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 4px;
        }

        .stat-label {
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
            min-width: auto;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            color: white;
            box-shadow: 
                0 8px 30px rgba(102, 126, 234, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            padding: 18px 32px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            position: relative;
            overflow: hidden;
            animation: pulse 2s infinite;
        }

        .btn-primary::before {
            content: 'üöÄ';
            margin-right: 12px;
            font-size: 18px;
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 15px 40px rgba(102, 126, 234, 0.6),
                0 5px 15px rgba(118, 75, 162, 0.4);
            animation: gradientShift 0.5s ease;
        }

        .btn-primary:active {
            transform: translateY(-1px) scale(1.01);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(100, 116, 139, 0.4);
        }

        .btn-outline {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-outline:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-error {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            color: #991b1b;
            border: 2px solid #fca5a5;
            border-radius: 16px;
            padding: 16px 20px;
            font-weight: 600;
            font-size: 15px;
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.2);
            animation: slideInDown 0.5s ease;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .alert-error::before {
            content: '‚ö†Ô∏è';
            margin-right: 12px;
            font-size: 18px;
        }

        /* ================================================
           RESPONSIVE DESIGN - MEDIA QUERIES
           ================================================ */

        /* Mobile Portrait - hasta 480px */
        @media (max-width: 480px) {
            .generator-section .mobile-menu-toggle {
                display: block !important;
            }
            .login-section.active {
                padding: 20px 15px;
                max-width: 100%;
                min-height: 100vh;
            }

            .login-section .header h1 {
                font-size: 2rem;
                margin-bottom: 12px;
            }

            .login-section .header p {
                font-size: 1rem;
            }

            #loginForm {
                padding: 30px 20px;
                border-radius: 20px;
            }

            .form-group input {
                padding: 16px 20px;
                font-size: 16px;
            }

            .btn-primary {
                padding: 16px 24px;
                font-size: 15px;
            }

            .dashboard {
                flex-direction: column;
                height: auto;
                max-height: none;
            }

            .sidebar {
                width: 280px;
                padding: 20px 15px;
                position: fixed;
                top: 0;
                left: -100%;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
                background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
                box-shadow: 2px 0 20px rgba(0,0,0,0.3);
            }

            .sidebar.show {
                left: 0;
            }

            .main-content {
                padding: 80px 15px 20px;
                width: 100%;
            }

            .content-header h2 {
                font-size: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .license-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .card {
                padding: 20px;
            }

            .mobile-menu-toggle {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1001;
                background: #667eea;
                color: white;
                border: none;
                padding: 12px;
                border-radius: 10px;
                font-size: 18px;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            }

            /* Tablas responsivas en m√≥vil */
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                font-size: 12px;
            }

            table thead {
                display: none;
            }

            table tbody {
                display: block;
            }

            table tbody tr {
                display: block;
                background: white;
                margin-bottom: 15px;
                padding: 15px;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                border-left: 4px solid #667eea;
                position: relative;
            }

            table tbody td {
                display: block;
                border: none;
                padding: 8px 0;
                text-align: left;
                position: relative;
                padding-left: 40%;
            }

            table tbody td:before {
                content: attr(data-label);
                position: absolute;
                left: 0;
                width: 35%;
                font-weight: 700;
                color: #374151;
                text-transform: uppercase;
                font-size: 10px;
                letter-spacing: 1px;
            }

            .license-actions {
                justify-content: center;
                margin-top: 15px;
            }

            .license-actions button {
                font-size: 11px;
                padding: 8px 12px;
            }
        }

        /* Mobile Landscape - 481px a 768px */
        @media (min-width: 481px) and (max-width: 768px) {
            .generator-section .mobile-menu-toggle {
                display: block !important;
            }
            .login-section.active {
                padding: 30px 20px;
                max-width: 450px;
            }

            .login-section .header h1 {
                font-size: 2.5rem;
            }

            #loginForm {
                padding: 40px 30px;
            }

            .dashboard {
                height: auto;
                max-height: none;
            }

            .dashboard {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 20px 15px;
                position: fixed;
                top: 0;
                left: -100%;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
            }

            .sidebar.show {
                left: 0;
            }

            .main-content {
                padding: 80px 25px 25px;
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .license-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }

        /* Tablet - 769px a 1024px */
        @media (min-width: 769px) and (max-width: 1024px) {
            .dashboard {
                height: 100vh;
            }

            .sidebar {
                width: 260px;
            }

            .main-content {
                padding: 30px;
            }

            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .license-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .mobile-menu-toggle {
                display: none;
            }
        }

        /* Desktop Large - m√°s de 1024px */
        @media (min-width: 1025px) {
            .container {
                max-width: 1400px;
            }

            .dashboard {
                height: 100vh;
            }

            .sidebar {
                width: 300px;
            }

            .main-content {
                padding: 40px;
            }

            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .license-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .mobile-menu-toggle {
                display: none;
            }
        }

        /* Desktop Extra Large - m√°s de 1440px */
        @media (min-width: 1441px) {
            .container {
                max-width: 1600px;
            }

            .license-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Responsive utilities */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
            transition: all 0.3s ease;
        }

        .mobile-menu-toggle:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }

        .mobile-menu-toggle:active {
            transform: scale(0.95);
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar-overlay.show {
            display: block;
            opacity: 1;
        }

        /* Mejoras para touch devices */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 48px;
                padding: 16px 24px;
            }

            .nav-link {
                padding: 16px 20px;
                min-height: 48px;
            }

            .form-group input {
                min-height: 48px;
                padding: 16px 20px;
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .license-card {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .license-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .license-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .license-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }

        .license-row strong {
            color: #333;
        }

        .license-key {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border: 2px dashed #ffc107;
            margin: 15px 0;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #856404;
            text-align: center;
            font-size: 16px;
        }

        .licenses-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .license-item {
            background: #f8f9fa;
            border-left: 4px solid #e67e22;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .license-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .license-item.expired {
            border-left-color: #ef4444;
            opacity: 0.7;
        }

        .license-item h4 {
            color: #e67e22;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .license-item p {
            margin: 5px 0;
            font-size: 14px;
            color: #666;
        }

        .logout-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            z-index: 10;
        }

        .logout-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .back-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3);
            z-index: 10;
        }

        .back-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(100, 116, 139, 0.4);
        }

        .license-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn-renovar, .btn-eliminar {
            padding: 8px 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-renovar {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-renovar:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-eliminar {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-eliminar:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .btn-suspender {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .btn-suspender:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        .btn-activar {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .btn-activar:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(6, 182, 212, 0.4);
        }

        .btn-editar {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .btn-editar:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .license-item.suspended {
            border-left-color: #ffc107;
            opacity: 0.6;
            background: #fff3cd;
        }

        /* Estilos de tablas modernas */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        table thead {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            color: white;
        }

        table thead th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        table tbody tr {
            border-bottom: 1px solid #e0e0e0;
            transition: background 0.3s;
        }

        table tbody tr:hover {
            background: #f8f9fa;
        }

        table tbody td {
            padding: 12px 15px;
            font-size: 14px;
            color: #333;
        }

        table tbody tr:last-child {
            border-bottom: none;
        }

        .licenses-table {
            margin-top: 20px;
            overflow-x: auto;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-expired {
            background: #f8d7da;
            color: #721c24;
        }

        .status-suspended {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <button id="backBtn" class="back-btn" style="display: none;" onclick="volverLogin()">‚Üê Volver</button>
        <button id="logoutBtn" class="logout-btn" style="display: none;" onclick="cerrarSesion()">Cerrar Sesi√≥n</button>
        
        <!-- Login Section -->
        <div id="loginSection" class="login-section active">
            <div class="header">
                <h1>üîê Generador de Licencias</h1>
                <p>Sistema de Gesti√≥n de Taller - Administrador</p>
            </div>

            <div id="loginError" style="display: none;" class="alert alert-error"></div>

            <form id="loginForm" onsubmit="iniciarSesion(event)">
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" required autocomplete="username" placeholder="Ingresa tu usuario administrativo">
                </div>

                <div class="form-group">
                    <label for="password">Contrase√±a</label>
                    <input type="password" id="password" required autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>

                <button type="submit" class="btn btn-primary">Acceder al Sistema</button>
            </form>

            <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e5e7eb;">
                <p style="text-align: center; color: #6b7280; margin-bottom: 15px; font-weight: 600;">¬øEres cliente? Consulta tu licencia</p>
                <button type="button" class="btn btn-secondary" onclick="mostrarConsultaLicencia()" style="width: 100%; background: #10b981;">üîç Consultar Mi Licencia</button>
            </div>
        </div>

        <!-- Consulta de Licencia Section -->
        <div id="consultaLicenciaSection" class="login-section" style="display: none;">
            <div class="header">
                <h1>üîç Consultar Licencia</h1>
                <p>Ingresa tu clave de licencia para ver los detalles</p>
            </div>

            <div id="consultaError" style="display: none;" class="alert alert-error"></div>
            <div id="consultaSuccess" style="display: none;" class="alert alert-success"></div>

            <form id="consultaForm" onsubmit="consultarLicencia(event)">
                <div class="form-group">
                    <label for="licenseKeyConsulta">Clave de Licencia</label>
                    <input type="text" id="licenseKeyConsulta" required placeholder="TT-XXX-XXXXXXXX-XXXXXX-XXXX" style="font-family: 'Courier New', monospace;">
                </div>

                <button type="submit" class="btn btn-primary">üîç Consultar</button>
                <button type="button" class="btn btn-secondary" onclick="volverLogin()" style="margin-top: 10px; width: 100%;">‚Üê Volver al Login</button>
            </form>

            <div id="licenseDataView" style="display: none; margin-top: 30px;">
                <div class="card">
                    <div class="card-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        <h3 class="card-title" style="color: white;">
                            <span class="card-icon">‚úÖ</span>
                            Informaci√≥n de tu Licencia
                        </h3>
                    </div>
                    <div id="licenseDataContent" style="padding: 20px;"></div>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="generatorSection" class="generator-section">
            <!-- Mobile menu toggle -->
            <button class="mobile-menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
            
            <!-- Sidebar overlay for mobile -->
            <div class="sidebar-overlay" onclick="closeSidebar()"></div>
            
            <div class="dashboard">
                <!-- Sidebar -->
                <div class="sidebar">
                    <div class="sidebar-header">
                        <h1>üîê Tu Taller</h1>
                        <p>Sistema de Licencias</p>
                    </div>
                    
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <div class="nav-link active" onclick="showSection('generator')">
                                <span class="nav-icon">‚öôÔ∏è</span>
                                Generar Licencias
                            </div>
                        </li>
                        <li class="nav-item">
                            <div class="nav-link" onclick="showSection('licenses')">
                                <span class="nav-icon">üìã</span>
                                Licencias Activas
                            </div>
                        </li>
                        <li class="nav-item">
                            <div class="nav-link" onclick="showSection('users')">
                                <span class="nav-icon">üë•</span>
                                Usuarios
                            </div>
                        </li>
                        <li class="nav-item">
                            <div class="nav-link" onclick="showSection('statistics')">
                                <span class="nav-icon">üìä</span>
                                Estad√≠sticas
                            </div>
                        </li>
                        <li class="nav-item" style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; margin-top: 10px;">
                            <div class="nav-link" onclick="forzarMigracionManual()" style="background: rgba(16, 185, 129, 0.1); color: #10b981;">
                                <span class="nav-icon">üîÑ</span>
                                Migrar Datos Locales
                            </div>
                        </li>
                        <li class="nav-item" style="margin-top: auto;">
                            <div class="nav-link" onclick="cerrarSesion()">
                                <span class="nav-icon">üö™</span>
                                Cerrar Sesi√≥n
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Main Content -->
                <div class="main-content">
                    <!-- Generator Section -->
                    <div id="section-generator" class="content-section">
                        <div class="content-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <div>
                                <h2>‚öôÔ∏è Generar Nueva Licencia</h2>
                                <p>Crea licencias personalizadas para tus clientes</p>
                            </div>
                            <button onclick="sincronizarDatosFirebase()" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                <span style="font-size: 16px;">üîÑ</span>
                                Sincronizar con Firebase
                            </button>
                        </div>

                        <div id="successMessage" style="display: none;" class="alert alert-success"></div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span class="card-icon">üìù</span>
                                    Datos del Cliente
                                </h3>
                            </div>
                            
                            <form id="licenseForm" onsubmit="generarLicencia(event)">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="clientName">Nombre del Cliente/Taller</label>
                                        <input type="text" id="clientName" required placeholder="Ej: Taller TecnoCell">
                                    </div>

                                    <div class="form-group">
                                        <label for="clientEmail">Email del Cliente</label>
                                        <input type="email" id="clientEmail" required placeholder="ejemplo@correo.com">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="licenseType">Tipo de Licencia</label>
                                        <select id="licenseType">
                                            <option value="prueba">üîç Prueba - 3 d√≠as</option>
                                            <option value="mensual">üìÖ Mensual - 30 d√≠as</option>
                                            <option value="trimestral">üóìÔ∏è Trimestral - 90 d√≠as</option>
                                            <option value="semestral">üìÜ Semestral - 180 d√≠as</option>
                                            <option value="anual">üéØ Anual - 365 d√≠as</option>
                                            <option value="vitalicia">‚ôæÔ∏è Vitalicia - Sin expiraci√≥n</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="maxDevices">M√°ximo de Dispositivos</label>
                                        <input type="number" id="maxDevices" value="1" min="1" max="10" required>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary">
                                    ‚öôÔ∏è Generar Licencia
                                </button>
                            </form>
                        </div>

                        <div id="licenseResult" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <span class="card-icon">‚úÖ</span>
                                        Licencia Generada Exitosamente
                                    </h3>
                                </div>
                                <div class="license-info" id="licenseDetails"></div>
                                <div class="license-key" id="licenseKeyDisplay"></div>
                                <div style="display: flex; gap: 12px; margin-top: 20px;">
                                    <button class="btn btn-success" onclick="copiarLicencia()">üìã Copiar</button>
                                    <button class="btn btn-secondary" onclick="descargarLicencia()">üíæ Descargar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Licenses Section -->
                    <div id="section-licenses" class="content-section" style="display: none;">
                        <div class="content-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <div>
                                <h2>üìã Licencias Activas</h2>
                                <p>Administra todas las licencias del sistema</p>
                            </div>
                            <button onclick="sincronizarDatosFirebase()" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                <span style="font-size: 16px;">üîÑ</span>
                                Sincronizar
                            </button>
                        </div>
                        <div class="card">
                            <div id="licensesList"></div>
                        </div>
                    </div>

                    <!-- Users Section -->
                    <div id="section-users" class="content-section" style="display: none;">
                        <div class="content-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <div>
                                <h2>üë• Administraci√≥n de Usuarios</h2>
                                <p>Gestiona los usuarios registrados y resetea contrase√±as</p>
                            </div>
                            <button onclick="sincronizarDatosFirebase()" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                <span style="font-size: 16px;">üîÑ</span>
                                Sincronizar
                            </button>
                        </div>
                        
                        <!-- Formulario para crear usuario manualmente -->
                        <div class="card" id="formCrearUsuario" style="display: none; margin-bottom: 20px;">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span class="card-icon">‚ûï</span>
                                    Crear Usuario Manualmente
                                </h3>
                                <button class="btn" onclick="ocultarFormCrearUsuario()" style="background: #ef4444; color: white;">
                                    ‚úñÔ∏è Cancelar
                                </button>
                            </div>
                            <form id="crearUsuarioForm" onsubmit="crearUsuarioManual(event)" style="padding: 20px;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="nuevoUsuario">Usuario *</label>
                                        <input type="text" id="nuevoUsuario" required placeholder="ej: carlos.tec">
                                    </div>
                                    <div class="form-group">
                                        <label for="nuevaPassword">Contrase√±a *</label>
                                        <input type="text" id="nuevaPassword" required placeholder="ej: Layla1509">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="nuevoEmail">Email</label>
                                        <input type="email" id="nuevoEmail" placeholder="correo@ejemplo.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="nuevoNombreTaller">Nombre del Taller *</label>
                                        <input type="text" id="nuevoNombreTaller" required placeholder="ej: Taller TecnoCell">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="nuevaLicenseKey">Clave de Licencia (opcional)</label>
                                    <input type="text" id="nuevaLicenseKey" placeholder="Si tiene licencia, ingresar aqu√≠">
                                </div>
                                <button type="submit" class="btn btn-primary" style="width: 100%;">
                                    ‚úÖ Crear Usuario
                                </button>
                            </form>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span class="card-icon">üë§</span>
                                    Lista de Usuarios
                                </h3>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-primary" onclick="mostrarFormCrearUsuario()">
                                        ‚ûï Crear Usuario
                                    </button>
                                    <button class="btn" onclick="mostrarImportarDatos()" style="background: #8b5cf6; color: white;">
                                        üì• Importar Datos
                                    </button>
                                    <button class="btn btn-primary" onclick="cargarUsuarios()">
                                        üîÑ Actualizar
                                    </button>
                                </div>
                            </div>
                            <div id="usuariosList"></div>
                        </div>
                        
                        <!-- Modal para importar datos -->
                        <div id="modalImportar" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
                            <div class="card" style="width: 90%; max-width: 600px; margin: 20px;">
                                <div class="card-header">
                                    <h3 class="card-title">üì• Importar Datos de Usuario</h3>
                                    <button class="btn" onclick="cerrarImportarDatos()" style="background: #ef4444; color: white;">‚úñÔ∏è</button>
                                </div>
                                <div style="padding: 20px;">
                                    <p style="margin-bottom: 15px; color: #64748b;">Pega aqu√≠ el JSON exportado desde la otra PC:</p>
                                    <div class="form-group">
                                        <label for="usuarioImportar">Usuario destino *</label>
                                        <input type="text" id="usuarioImportar" placeholder="ej: carlos.tec" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="jsonImportar">Datos JSON *</label>
                                        <textarea id="jsonImportar" rows="10" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-family: monospace; font-size: 12px;" placeholder='{"clientes": [...], "ordenes": [...], "repuestos": [...]}'></textarea>
                                    </div>
                                    <button class="btn btn-primary" onclick="importarDatosUsuario()" style="width: 100%;">
                                        ‚úÖ Importar a Firebase
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Section -->
                    <div id="section-statistics" class="content-section" style="display: none;">
                        <div class="content-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <div>
                                <h2>üìä Panel de Estad√≠sticas</h2>
                                <p>M√©tricas y an√°lisis del sistema</p>
                            </div>
                            <button onclick="sincronizarDatosFirebase()" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                <span style="font-size: 16px;">üîÑ</span>
                                Sincronizar
                            </button>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="totalLicenses">0</div>
                                <div class="stat-label">Total Licencias</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="totalUsers">0</div>
                                <div class="stat-label">Usuarios Registrados</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="activeLicenses">0</div>
                                <div class="stat-label">Licencias Activas</div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span class="card-icon">üìà</span>
                                    Resumen General
                                </h3>
                            </div>
                            <div id="statisticsContent">
                                <p>Las estad√≠sticas se cargan autom√°ticamente...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CREDENCIALES = {
            usuario: 'admin_licencias',
            password: 'SecurePass2025!'
        };

        // Verificar si hay sesi√≥n activa al cargar
        window.addEventListener('DOMContentLoaded', () => {
            const sesionActiva = localStorage.getItem('licenciasSession');
            if (sesionActiva === 'activa') {
                mostrarGenerador();
            } else {
                // Si no hay sesi√≥n activa, mostrar login
                document.body.classList.add('login-mode');
            }
        });

        function iniciarSesion(event) {
            event.preventDefault();
            const usuario = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (usuario === 'admin_licencias' && password === 'SecurePass2025!') {
                localStorage.setItem('licenciasSession', 'activa');
                mostrarGenerador();
                return;
            }
            
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = '‚ùå Usuario o contrase√±a incorrectos';
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function cerrarSesion() {
            localStorage.removeItem('licenciasSession');
            document.getElementById('loginSection').classList.add('active');
            document.getElementById('generatorSection').classList.remove('active');
            document.body.classList.remove('dashboard-mode');
            document.body.classList.add('login-mode');
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('backBtn').style.display = 'none';
            document.getElementById('loginForm').reset();
        }

        function volverLogin() {
            if (confirm('¬øDeseas volver al login? No se cerrar√° tu sesi√≥n.')) {
                document.getElementById('loginSection').classList.add('active');
                document.getElementById('generatorSection').classList.remove('active');
                document.body.classList.remove('dashboard-mode');
                document.body.classList.add('login-mode');
                document.getElementById('logoutBtn').style.display = 'none';
                document.getElementById('backBtn').style.display = 'none';
            }
        }

        async function mostrarGenerador() {
            document.getElementById('loginSection').classList.remove('active');
            document.getElementById('generatorSection').classList.add('active');
            document.body.classList.remove('login-mode');
            document.body.classList.add('dashboard-mode');
            showSection('generator');
            
            // PRIMERO: Migrar datos locales a Firebase si existen
            await migrarDatosLocalAFirebase();
            
            // SEGUNDO: Sincronizar datos desde Firebase al abrir el panel
            await sincronizarDatosFirebase();
        }
        
        // Funci√≥n para sincronizar todos los datos desde Firebase
        async function sincronizarDatosFirebase() {
            try {
                console.log('üîÑ Sincronizando datos desde Firebase...');
                mostrarNotificacion('üîÑ Sincronizando con Firebase...', 'info');
                
                // Cargar todas las colecciones en paralelo
                await Promise.all([
                    cargarLicencias(),
                    cargarUsuarios(),
                    cargarEstadisticas()
                ]);
                
                // Contar datos cargados
                const licenciasSnapshot = await db.collection('licencias').get();
                const usuariosSnapshot = await db.collection('usuarios').get();
                const usuariosGoogleSnapshot = await db.collection('usuarios-google').get();
                
                const totalLicencias = licenciasSnapshot.size;
                const totalUsuarios = usuariosSnapshot.size;
                const totalUsuariosGoogle = usuariosGoogleSnapshot.size;
                
                console.log(`‚úÖ Datos sincronizados: ${totalLicencias} licencias, ${totalUsuarios} usuarios, ${totalUsuariosGoogle} usuarios Google`);
                
                // Mostrar notificaci√≥n de √©xito con detalles
                mostrarNotificacion(
                    `‚úÖ Sincronizado: ${totalLicencias} licencias ‚Ä¢ ${totalUsuarios + totalUsuariosGoogle} usuarios`, 
                    'success'
                );
                
            } catch (error) {
                console.error('‚ùå Error al sincronizar datos:', error);
                mostrarNotificacion('‚ö†Ô∏è Error al sincronizar. Verifica tu conexi√≥n.', 'error');
            }
        }
        
        // Funci√≥n para mostrar notificaciones temporales
        function mostrarNotificacion(mensaje, tipo = 'info') {
            const notificacion = document.createElement('div');
            notificacion.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                border-radius: 12px;
                color: white;
                font-weight: 600;
                font-size: 14px;
                z-index: 10000;
                max-width: 400px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.2);
                animation: slideInRight 0.3s ease;
                background: ${tipo === 'success' ? 'linear-gradient(135deg, #10b981, #059669)' : 
                            tipo === 'error' ? 'linear-gradient(135deg, #ef4444, #dc2626)' : 
                            tipo === 'warning' ? 'linear-gradient(135deg, #f59e0b, #d97706)' :
                            'linear-gradient(135deg, #3b82f6, #1d4ed8)'};
            `;
            notificacion.textContent = mensaje;
            
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => notificacion.remove(), 300);
            }, 3000);
        }

        function showSection(sectionName) {
            // Ocultar todas las secciones
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.style.display = 'none');
            
            // Remover clase active de todos los nav-links
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            
            // Mostrar secci√≥n seleccionada
            const targetSection = document.getElementById('section-' + sectionName);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // Agregar clase active al nav-link correspondiente
            const activeNavLink = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
            if (activeNavLink) {
                activeNavLink.classList.add('active');
            }
            
            // Cargar datos espec√≠ficos seg√∫n la secci√≥n
            if (sectionName === 'licenses') {
                cargarLicencias();
            } else if (sectionName === 'users') {
                cargarUsuarios();
            } else if (sectionName === 'statistics') {
                cargarEstadisticas();
            }

            // Cerrar sidebar en m√≥vil despu√©s de seleccionar secci√≥n
            closeSidebar();
        }

        // Funciones para el men√∫ m√≥vil
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            if (sidebar && overlay) {
                sidebar.classList.toggle('show');
                overlay.classList.toggle('show');
                
                // Prevenir scroll del body cuando el men√∫ est√° abierto
                if (sidebar.classList.contains('show')) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = '';
                }
            }
        }

        function closeSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            if (sidebar && overlay) {
                sidebar.classList.remove('show');
                overlay.classList.remove('show');
                document.body.style.overflow = '';
            }
        }

        // Funci√≥n para migrar datos de localStorage a Firebase
        async function migrarDatosLocalAFirebase() {
            try {
                console.log('üîÑ Iniciando verificaci√≥n y migraci√≥n de datos locales a Firebase...');
                
                let licenciasMigradas = 0;
                let usuariosMigrados = 0;
                
                // Migrar licencias
                const licenciasLocal = JSON.parse(localStorage.getItem('licenciasGeneradas') || '[]');
                if (licenciasLocal.length > 0) {
                    console.log(`üìã Encontradas ${licenciasLocal.length} licencias en localStorage`);
                    
                    for (const licencia of licenciasLocal) {
                        try {
                            // Verificar si ya existe en Firebase
                            const snapshot = await db.collection('licencias')
                                .where('licenseKey', '==', licencia.licenseKey)
                                .get();
                            
                            if (snapshot.empty) {
                                // No existe, agregarla
                                await db.collection('licencias').add(licencia);
                                licenciasMigradas++;
                                console.log(`‚úÖ Licencia migrada: ${licencia.clientName} (${licencia.licenseKey})`);
                            } else {
                                console.log(`‚ÑπÔ∏è Licencia ya existe en Firebase: ${licencia.clientName}`);
                            }
                        } catch (error) {
                            console.error(`‚ùå Error al migrar licencia ${licencia.licenseKey}:`, error);
                        }
                    }
                }
                
                // Migrar usuarios
                const usuariosLocal = JSON.parse(localStorage.getItem('usuariosRegistrados') || '[]');
                if (usuariosLocal.length > 0) {
                    console.log(`üë• Encontrados ${usuariosLocal.length} usuarios en localStorage`);
                    
                    for (const usuario of usuariosLocal) {
                        try {
                            // Verificar si ya existe en Firebase
                            const snapshot = await db.collection('usuarios')
                                .where('usuario', '==', usuario.usuario)
                                .get();
                            
                            if (snapshot.empty) {
                                // No existe, agregarlo
                                await db.collection('usuarios').add(usuario);
                                usuariosMigrados++;
                                console.log(`‚úÖ Usuario migrado: ${usuario.usuario}`);
                            } else {
                                console.log(`‚ÑπÔ∏è Usuario ya existe en Firebase: ${usuario.usuario}`);
                            }
                        } catch (error) {
                            console.error(`‚ùå Error al migrar usuario ${usuario.usuario}:`, error);
                        }
                    }
                }
                
                // Mostrar resultado
                if (licenciasMigradas > 0 || usuariosMigrados > 0) {
                    console.log(`‚úÖ Migraci√≥n completada: ${licenciasMigradas} licencias, ${usuariosMigrados} usuarios`);
                    
                    // Limpiar localStorage despu√©s de migrar exitosamente
                    if (licenciasMigradas > 0) {
                        console.log('üßπ Limpiando licencias del localStorage despu√©s de migrar...');
                        localStorage.removeItem('licenciasGeneradas');
                    }
                    if (usuariosMigrados > 0) {
                        console.log('üßπ Limpiando usuarios del localStorage despu√©s de migrar...');
                        localStorage.removeItem('usuariosRegistrados');
                    }
                    
                    mostrarNotificacion(
                        `‚úÖ Datos migrados a Firebase: ${licenciasMigradas} licencias, ${usuariosMigrados} usuarios`, 
                        'success'
                    );
                } else if (licenciasLocal.length > 0 || usuariosLocal.length > 0) {
                    console.log('‚ÑπÔ∏è Todos los datos locales ya est√°n en Firebase');
                } else {
                    console.log('‚ÑπÔ∏è No hay datos locales para migrar');
                }
                
            } catch (error) {
                console.error('‚ùå Error en la migraci√≥n:', error);
                mostrarNotificacion('‚ö†Ô∏è Error al migrar datos. Revisa la consola.', 'error');
            }
        }
        
        // Funci√≥n para forzar migraci√≥n manual (con di√°logo de confirmaci√≥n)
        async function forzarMigracionManual() {
            const licenciasLocal = JSON.parse(localStorage.getItem('licenciasGeneradas') || '[]');
            const usuariosLocal = JSON.parse(localStorage.getItem('usuariosRegistrados') || '[]');
            
            if (licenciasLocal.length === 0 && usuariosLocal.length === 0) {
                alert('‚ÑπÔ∏è No hay datos en localStorage para migrar.\n\nTodos los datos ya est√°n en Firebase o no hay datos locales.');
                return;
            }
            
            const confirmar = confirm(
                `üîÑ MIGRACI√ìN DE DATOS LOCALES A FIREBASE\n\n` +
                `Datos encontrados en este dispositivo:\n` +
                `‚Ä¢ Licencias: ${licenciasLocal.length}\n` +
                `‚Ä¢ Usuarios: ${usuariosLocal.length}\n\n` +
                `¬øDeseas migrar estos datos a Firebase?\n\n` +
                `Esto permitir√° verlos en todos tus dispositivos.`
            );
            
            if (confirmar) {
                await migrarDatosLocalAFirebase();
                await sincronizarDatosFirebase();
            }
        }

        // Cerrar sidebar al hacer clic en enlaces de navegaci√≥n en m√≥vil
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        setTimeout(closeSidebar, 100);
                    }
                });
            });

            // Cerrar sidebar al redimensionar ventana
            window.addEventListener('resize', () => {
                if (window.innerWidth > 768) {
                    closeSidebar();
                }
            });

            // Agregar funcionalidad de swipe para cerrar el men√∫
            let startX = 0;
            const sidebar = document.querySelector('.sidebar');
            
            if (sidebar) {
                sidebar.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                }, { passive: true });
                
                sidebar.addEventListener('touchend', (e) => {
                    const endX = e.changedTouches[0].clientX;
                    const diffX = startX - endX;
                    
                    // Si se hace swipe hacia la izquierda, cerrar men√∫
                    if (diffX > 50) {
                        closeSidebar();
                    }
                }, { passive: true });
            }
            
            // Ejecutar migraci√≥n autom√°ticamente al cargar
            setTimeout(() => {
                migrarDatosLocalAFirebase();
            }, 2000);
        });

        async function cargarEstadisticas() {
            try {
                // Cargar todas las licencias desde Firebase
                const snapshot = await db.collection('licencias').get();
                const licenciasFirebase = [];
                snapshot.forEach(doc => {
                    licenciasFirebase.push(doc.data());
                });
                
                // Cargar usuarios de Google
                const googleSnapshot = await db.collection('usuarios-google').get();
                const usuariosGoogle = [];
                googleSnapshot.forEach(doc => {
                    usuariosGoogle.push(doc.data());
                });
                
                const totalLicencias = licenciasFirebase.length + usuariosGoogle.length;
                const totalUsuarios = usuariosGoogle.length;
                
                document.getElementById('totalLicenses').textContent = totalLicencias;
                document.getElementById('totalUsers').textContent = totalUsuarios;
                
                // Calcular licencias activas (no vencidas ni suspendidas)
                const ahora = new Date();
                const licenciasActivas = licenciasFirebase.filter(lic => {
                    if (lic.suspendida) return false;
                    if (lic.licenseType === 'vitalicia') return true;
                    if (!lic.fechaExpiracion) return true;
                    const expiracion = new Date(lic.fechaExpiracion);
                    return expiracion > ahora;
                });
                
                document.getElementById('activeLicenses').textContent = licenciasActivas.length + usuariosGoogle.filter(u => !u.suspendido).length;
                
                // Generar contenido de estad√≠sticas
                let estadisticasHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h4 style="color: #667eea; margin-bottom: 10px;">üìã Por Tipo de Licencia</h4>
                            <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                `;
                
                const tiposLicencia = {};
                licenciasFirebase.forEach(lic => {
                    tiposLicencia[lic.licenseType] = (tiposLicencia[lic.licenseType] || 0) + 1;
                });
                
                Object.entries(tiposLicencia).forEach(([tipo, cantidad]) => {
                    estadisticasHTML += `<p><strong>${tipo}:</strong> ${cantidad}</p>`;
                });
                
                estadisticasHTML += `
                            </div>
                        </div>
                        <div>
                            <h4 style="color: #667eea; margin-bottom: 10px;">üìä Estado General</h4>
                            <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                                <p><strong>Usuarios Google:</strong> ${usuariosGoogle.length}</p>
                                <p><strong>Licencias Vencidas:</strong> ${licenciasFirebase.length - licenciasActivas.length}</p>
                                <p><strong>Dispositivos M√°ximos:</strong> ${licenciasFirebase.reduce((acc, lic) => acc + (lic.maxDevices || 1), 0)}</p>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('statisticsContent').innerHTML = estadisticasHTML;
            } catch (error) {
                console.error('Error al cargar estad√≠sticas:', error);
                document.getElementById('statisticsContent').innerHTML = '<p style="color: #ef4444;">‚ùå Error al cargar estad√≠sticas</p>';
            }
        }

        async function generarLicencia(event) {
            event.preventDefault();

            const clientName = document.getElementById('clientName').value;
            const clientEmail = document.getElementById('clientEmail').value;
            const licenseType = document.getElementById('licenseType').value;
            const maxDevices = parseInt(document.getElementById('maxDevices').value);

            // Calcular fecha de expiraci√≥n
            const fechaCreacion = new Date();
            let fechaExpiracion = null;
            let dias = 0;

            switch (licenseType) {
                case 'prueba': dias = 3; break;
                case 'mensual': dias = 30; break;
                case 'trimestral': dias = 90; break;
                case 'semestral': dias = 180; break;
                case 'anual': dias = 365; break;
                case 'vitalicia': dias = 0; break;
            }

            if (dias > 0) {
                fechaExpiracion = new Date();
                fechaExpiracion.setDate(fechaExpiracion.getDate() + dias);
            }

            // Generar c√≥digo de licencia √∫nico
            const licenseKey = generarCodigoLicencia(clientName, licenseType);

            const licencia = {
                clientName,
                clientEmail,
                licenseType,
                licenseKey,
                maxDevices,
                fechaCreacion: fechaCreacion.toISOString(),
                fechaExpiracion: fechaExpiracion ? fechaExpiracion.toISOString() : null,
                activa: true,
                suspendida: false
            };

            try {
                // Guardar licencia directamente en Firebase (fuente √∫nica de verdad)
                await db.collection('licencias').add(licencia);
                
                console.log('‚úÖ Licencia guardada en Firebase');

                // Mostrar resultado
                mostrarResultado(licencia);
                await cargarLicencias();
                await cargarEstadisticas();

                // Limpiar formulario
                document.getElementById('licenseForm').reset();
                
                alert('‚úÖ Licencia generada y guardada correctamente');
            } catch (error) {
                console.error('Error al generar licencia:', error);
                alert('‚ùå Error al guardar licencia. Por favor intenta de nuevo.');
            }
        }

        function generarCodigoLicencia(nombre, tipo) {
            const prefijo = tipo.substring(0, 3).toUpperCase();
            const nombreHash = btoa(nombre).substring(0, 8).toUpperCase().replace(/[^A-Z0-9]/g, '');
            const timestamp = Date.now().toString(36).toUpperCase();
            const random = Math.random().toString(36).substring(2, 6).toUpperCase();
            
            return `TT-${prefijo}-${nombreHash}-${timestamp}-${random}`;
        }

        function mostrarResultado(licencia) {
            const resultDiv = document.getElementById('licenseResult');
            const detailsDiv = document.getElementById('licenseDetails');
            const keyDisplay = document.getElementById('licenseKeyDisplay');

            const tipoTexto = {
                prueba: 'Prueba (3 d√≠as)',
                mensual: 'Mensual (30 d√≠as)',
                trimestral: 'Trimestral (90 d√≠as)',
                semestral: 'Semestral (180 d√≠as)',
                anual: 'Anual (365 d√≠as)',
                vitalicia: 'Vitalicia (Sin expiraci√≥n)'
            };

            detailsDiv.innerHTML = `
                <div class="license-row">
                    <strong>Cliente:</strong>
                    <span>${licencia.clientName}</span>
                </div>
                <div class="license-row">
                    <strong>Email:</strong>
                    <span>${licencia.clientEmail}</span>
                </div>
                <div class="license-row">
                    <strong>Tipo:</strong>
                    <span>${tipoTexto[licencia.licenseType]}</span>
                </div>
                <div class="license-row">
                    <strong>Dispositivos:</strong>
                    <span>${licencia.maxDevices}</span>
                </div>
                <div class="license-row">
                    <strong>Fecha Creaci√≥n:</strong>
                    <span>${new Date(licencia.fechaCreacion).toLocaleDateString()}</span>
                </div>
                ${licencia.fechaExpiracion ? `
                <div class="license-row">
                    <strong>Fecha Expiraci√≥n:</strong>
                    <span>${new Date(licencia.fechaExpiracion).toLocaleDateString()}</span>
                </div>
                ` : ''}
            `;

            keyDisplay.textContent = licencia.licenseKey;
            resultDiv.style.display = 'block';

            // Scroll al resultado
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        async function cargarLicencias() {
            const container = document.getElementById('licensesList');
            
            // Mostrar loading mientras carga
            container.innerHTML = '<p style="text-align: center; padding: 20px;">üîÑ Cargando licencias desde Firebase...</p>';
            
            try {
                console.log('üì• Cargando licencias desde Firebase...');
                
                // Cargar licencias solo desde Firebase
                const licenciasFirebase = [];
                
                // Verificar si Firebase est√° inicializado
                if (!window.firebase || !db) {
                    throw new Error('Firebase no est√° inicializado correctamente');
                }
                
                const snapshot = await db.collection('licencias')
                    .orderBy('fechaCreacion', 'desc')
                    .get();
                
                console.log(`üìä Documentos en colecci√≥n 'licencias': ${snapshot.size}`);
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    console.log('üìÑ Licencia:', doc.id, data.licenseKey);
                    licenciasFirebase.push({
                        id: doc.id,
                        ...data,
                        origen: 'Firebase'
                    });
                });

                // Cargar usuarios de Google y crear "licencias virtuales" para ellos
                const googleSnapshot = await db.collection('usuarios-google').get();
                const usuariosGoogle = [];
                
                console.log(`üîµ Usuarios de Google: ${googleSnapshot.size}`);
                
                googleSnapshot.forEach(doc => {
                    const data = doc.data();
                    // Crear una "licencia virtual" para cada usuario de Google
                    usuariosGoogle.push({
                        id: doc.id,
                        clientName: data.nombre || data.email.split('@')[0],
                        clientEmail: data.email,
                        licenseKey: data.email, // Usar email como identificador
                        licenseType: 'vitalicia',
                        maxDevices: 99,
                        fechaCreacion: data.fechaRegistro || new Date().toISOString(),
                        fechaExpiracion: null,
                        suspendida: data.suspendido || false,
                        origen: 'Google',
                        esUsuarioGoogle: true,
                        foto: data.foto,
                        ultimoAcceso: data.ultimoAcceso
                    });
                });

                // Todas las licencias desde Firebase
                const todasLicencias = [...licenciasFirebase, ...usuariosGoogle];
                
                console.log(`‚úÖ Total de licencias cargadas: ${todasLicencias.length} (Firebase: ${licenciasFirebase.length}, Google: ${usuariosGoogle.length})`);
                
                if (todasLicencias.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No hay licencias generadas</p>';
                    return;
                }

                const tipoTexto = {
                    prueba: 'Prueba',
                    mensual: 'Mensual',
                    trimestral: 'Trimestral',
                    semestral: 'Semestral',
                    anual: 'Anual',
                    vitalicia: 'Vitalicia'
                };

                // Cargar usuarios registrados desde Firebase
                const usuariosSnapshot = await db.collection('usuarios').get();
                const usuariosRegistrados = [];
                usuariosSnapshot.forEach(doc => {
                    usuariosRegistrados.push(doc.data());
                });
                
                // Generar HTML con estad√≠sticas
                let html = `
                    <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px;">
                        üìä <strong>Total de licencias:</strong> ${todasLicencias.length} 
                        | üî• Firebase: ${licenciasFirebase.length} 
                        | üîµ Google: ${usuariosGoogle.length}
                    </div>
                `;
            
                html += todasLicencias.map((lic, index) => {
                    const expirada = lic.fechaExpiracion && new Date(lic.fechaExpiracion) < new Date();
                    const suspendida = lic.suspendida === true;
                    let estado = '‚úÖ ACTIVA';
                    let claseEstado = '';
                    
                    if (suspendida) {
                        estado = '‚è∏Ô∏è SUSPENDIDA';
                        claseEstado = 'suspended';
                    } else if (expirada) {
                        estado = '‚ùå EXPIRADA';
                        claseEstado = 'expired';
                    }
                    
                    // Buscar usuario registrado con esta licencia
                    const usuarioRegistrado = usuariosRegistrados.find(u => u.licenseKey === lic.licenseKey);
                    const origen = lic.origen || 'Desconocido';
                    
                    return `
                        <div class="license-item ${claseEstado}" style="margin-bottom: 15px; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 4px solid ${origen === 'Google' ? '#4285f4' : '#667eea'};">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    ${lic.foto ? `<img src="${lic.foto}" alt="${lic.clientName}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : ''}
                                    <div>
                                        <h4 style="margin: 0 0 8px 0; color: #1e293b; font-size: 1.1em;">${lic.clientName}</h4>
                                        <span style="padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; ${estado.includes('ACTIVA') ? 'background: #dcfce7; color: #166534;' : estado.includes('SUSPENDIDA') ? 'background: #fef3c7; color: #92400e;' : 'background: #fee2e2; color: #b91c1c;'}">${estado}</span>
                                    </div>
                                </div>
                                <span style="padding: 2px 6px; border-radius: 3px; font-size: 10px; background: ${origen === 'Google' ? '#e8f0fe; color: #1967d2' : origen === 'Firebase' ? '#e8f5e8; color: #2e7d32' : '#fff3e0; color: #ef6c00'}">${origen === 'Google' ? 'üîµ Google' : origen}</span>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <p style="margin: 4px 0; font-size: 14px;"><strong>üìß Email:</strong> ${lic.clientEmail}</p>
                                    <p style="margin: 4px 0; font-size: 14px;"><strong>üéØ Tipo:</strong> ${tipoTexto[lic.licenseType] || lic.type}</p>
                                    <p style="margin: 4px 0; font-size: 14px;"><strong>üì± Dispositivos:</strong> ${lic.maxDevices || 1}</p>
                                </div>
                                <div>
                                    <p style="margin: 4px 0; font-size: 14px;"><strong>üìÖ Creada:</strong> ${new Date(lic.fechaCreacion || lic.creationDate).toLocaleDateString()}</p>
                                    ${lic.fechaExpiracion || lic.expirationDate ? `<p style="margin: 4px 0; font-size: 14px;"><strong>‚è∞ Expira:</strong> ${new Date(lic.fechaExpiracion || lic.expirationDate).toLocaleDateString()}</p>` : '<p style="margin: 4px 0; font-size: 14px;"><strong>‚ôæÔ∏è Sin expiraci√≥n</strong></p>'}
                                </div>
                            </div>

                            ${!lic.esUsuarioGoogle ? `
                                <div style="background: #f8fafc; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                                    <p style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; color: #374151;">üîë Clave de Licencia:</p>
                                    <p style="margin: 0; font-family: 'Courier New', monospace; background: white; padding: 8px; border-radius: 4px; border: 1px solid #e5e7eb; word-break: break-all; font-size: 12px;">${lic.licenseKey}</p>
                                </div>
                            ` : ''}

                            ${lic.esUsuarioGoogle ? `
                                <div style="background: #e8f0fe; border: 1px solid #aecbfa; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                                    <p style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; color: #1967d2;">üîµ Autenticaci√≥n Google</p>
                                    <p style="margin: 4px 0; font-size: 12px; color: #185abc;">‚úì Acceso directo con cuenta de Google</p>
                                    ${lic.ultimoAcceso ? `<p style="margin: 4px 0 0 0; font-size: 12px; color: #185abc;">üìÖ √öltimo acceso: ${new Date(lic.ultimoAcceso).toLocaleDateString()}</p>` : ''}
                                </div>
                            ` : usuarioRegistrado ? `
                                <div style="background: #f0fdf4; border: 1px solid #bbf7d0; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                                    <p style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; color: #166534;">‚úÖ Licencia Activada</p>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                        <p style="margin: 4px 0; font-size: 12px;"><strong>üë§ Usuario:</strong> <span style="font-family: monospace; color: #059669;">${usuarioRegistrado.usuario}</span></p>
                                        <p style="margin: 4px 0; font-size: 12px;"><strong>üîë Contrase√±a:</strong> <span style="font-family: monospace; color: #059669;">${usuarioRegistrado.password}</span></p>
                                    </div>
                                    <p style="margin: 4px 0 0 0; font-size: 12px; color: #065f46;">üìÖ Activada el ${new Date(usuarioRegistrado.fechaRegistro || Date.now()).toLocaleDateString()}</p>
                                </div>
                            ` : `
                                <div style="background: #fafafa; border: 1px solid #e5e7eb; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                                    <p style="margin: 0; font-size: 13px; color: #6b7280;">‚ö™ Licencia no activada - Sin usuario registrado</p>
                                </div>
                            `}

                            <div class="license-actions" style="display: flex; gap: 8px; flex-wrap: wrap;">
                                ${!lic.esUsuarioGoogle ? `<button class="btn-editar" onclick="editarLicenciaFirebase('${lic.licenseKey}').then(r => r && cargarLicencias())" style="padding: 6px 12px; font-size: 12px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer;">‚úèÔ∏è Editar</button>` : ''}
                                ${!lic.esUsuarioGoogle ? `<button class="btn-renovar" onclick="renovarLicenciaFirebase('${lic.licenseKey}').then(r => r && cargarLicencias())" style="padding: 6px 12px; font-size: 12px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">üîÑ Renovar</button>` : ''}
                                ${suspendida ? 
                                    `<button class="btn-activar" onclick="${lic.esUsuarioGoogle ? 'toggleSuspenderUsuarioGoogle' : 'toggleSuspenderLicenciaFirebase'}('${lic.licenseKey}').then(r => r && cargarLicencias())" style="padding: 6px 12px; font-size: 12px; background: #22c55e; color: white; border: none; border-radius: 6px; cursor: pointer;">‚ñ∂Ô∏è Activar</button>` :
                                    `<button class="btn-suspender" onclick="${lic.esUsuarioGoogle ? 'toggleSuspenderUsuarioGoogle' : 'toggleSuspenderLicenciaFirebase'}('${lic.licenseKey}').then(r => r && cargarLicencias())" style="padding: 6px 12px; font-size: 12px; background: #f97316; color: white; border: none; border-radius: 6px; cursor: pointer;">‚è∏Ô∏è Suspender</button>`
                                }
                                <button class="btn-eliminar" onclick="${lic.esUsuarioGoogle ? 'eliminarUsuarioGoogle' : 'eliminarLicenciaFirebase'}('${lic.licenseKey}').then(r => r && cargarLicencias())" style="padding: 6px 12px; font-size: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer;">üóëÔ∏è Eliminar</button>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error al cargar licencias:', error);
                container.innerHTML = `
                    <div style="text-align: center; color: #dc3545; padding: 20px; background: #fff5f5; border-radius: 6px; border: 1px solid #fed7d7;">
                        <h4>‚ùå Error al cargar licencias</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <button onclick="cargarLicencias()" style="margin-top: 10px; padding: 6px 12px;">üîÑ Reintentar</button>
                    </div>
                `;
            }
        }

        function copiarLicencia() {
            const licenseKey = document.getElementById('licenseKeyDisplay').textContent;
            navigator.clipboard.writeText(licenseKey).then(() => {
                alert('‚úÖ Licencia copiada al portapapeles');
            });
        }

        // ====== ADMINISTRACI√ìN DE USUARIOS ======

        function mostrarFormCrearUsuario() {
            document.getElementById('formCrearUsuario').style.display = 'block';
            document.getElementById('crearUsuarioForm').reset();
        }

        function ocultarFormCrearUsuario() {
            document.getElementById('formCrearUsuario').style.display = 'none';
            document.getElementById('crearUsuarioForm').reset();
        }

        async function crearUsuarioManual(event) {
            event.preventDefault();
            
            const usuario = document.getElementById('nuevoUsuario').value.trim();
            const password = document.getElementById('nuevaPassword').value.trim();
            const email = document.getElementById('nuevoEmail').value.trim();
            const nombreTaller = document.getElementById('nuevoNombreTaller').value.trim();
            const licenseKey = document.getElementById('nuevaLicenseKey').value.trim() || 'MANUAL-' + Date.now();
            
            if (!usuario || !password || !nombreTaller) {
                alert('‚ùå Por favor completa todos los campos obligatorios');
                return;
            }
            
            if (password.length < 4) {
                alert('‚ùå La contrase√±a debe tener al menos 4 caracteres');
                return;
            }
            
            try {
                // Verificar si el usuario ya existe
                const snapshot = await db.collection('usuarios')
                    .where('usuario', '==', usuario)
                    .get();
                
                if (!snapshot.empty) {
                    alert('‚ùå Ya existe un usuario con ese nombre. Elige otro nombre de usuario.');
                    return;
                }
                
                // Crear el nuevo usuario
                const nuevoUsuario = {
                    usuario: usuario,
                    password: password,
                    email: email || '',
                    nombreTaller: nombreTaller,
                    licenseKey: licenseKey,
                    fechaCreacion: new Date().toISOString(),
                    fechaRegistro: new Date().toISOString(),
                    estado: 'activo',
                    creadoPor: 'admin_manual'
                };
                
                await db.collection('usuarios').add(nuevoUsuario);
                
                alert(`‚úÖ Usuario creado exitosamente\n\nUsuario: ${usuario}\nContrase√±a: ${password}\nTaller: ${nombreTaller}`);
                
                ocultarFormCrearUsuario();
                await cargarUsuarios();
                
            } catch (error) {
                console.error('Error al crear usuario:', error);
                alert('‚ùå Error al crear el usuario. Por favor intenta de nuevo.');
            }
        }

        // Funci√≥n para vincular usuario con licencia existente
        async function vincularUsuarioConLicencia(usuario, clientName) {
            try {
                // Buscar la licencia por nombre del cliente
                const licenciaSnapshot = await db.collection('licencias')
                    .where('clientName', '==', clientName)
                    .get();
                
                if (licenciaSnapshot.empty) {
                    alert(`‚ùå No se encontr√≥ la licencia: ${clientName}`);
                    return false;
                }
                
                const licenciaData = licenciaSnapshot.docs[0].data();
                const licenseKey = licenciaData.licenseKey;
                
                // Buscar el usuario
                const usuarioSnapshot = await db.collection('usuarios')
                    .where('usuario', '==', usuario)
                    .get();
                
                if (usuarioSnapshot.empty) {
                    alert(`‚ùå No se encontr√≥ el usuario: ${usuario}`);
                    return false;
                }
                
                // Actualizar el usuario con la licenseKey
                const usuarioDoc = usuarioSnapshot.docs[0];
                await usuarioDoc.ref.update({
                    licenseKey: licenseKey,
                    clientName: clientName,
                    fechaVinculacion: new Date().toISOString()
                });
                
                alert(`‚úÖ Usuario vinculado correctamente\n\nUsuario: ${usuario}\nLicencia: ${clientName}\nKey: ${licenseKey}`);
                return true;
                
            } catch (error) {
                console.error('Error al vincular:', error);
                alert('‚ùå Error al vincular usuario con licencia');
                return false;
            }
        }

        // Ejecutar autom√°ticamente la vinculaci√≥n al cargar la p√°gina
        window.addEventListener('DOMContentLoaded', async () => {
            // Esperar a que Firebase se inicialice
            setTimeout(async () => {
                console.log('üîó Vinculando carlos.tec con smart cell...');
                await vincularUsuarioConLicencia('carlos.tec', 'smart cell');
            }, 3000);
        });

        async function cargarUsuarios() {
            const container = document.getElementById('usuariosList');
            
            // Mostrar loading mientras carga
            container.innerHTML = '<p style="text-align: center; padding: 20px;">üîÑ Cargando usuarios desde Firebase...</p>';
            
            try {
                // Cargar usuarios solo desde Firebase
                const usuariosFirebase = [];
                const usuariosGoogle = [];
                
                // Verificar si Firebase est√° inicializado
                if (!window.firebase || !db) {
                    throw new Error('Firebase no est√° inicializado correctamente');
                }
                
                // Usuarios normales de Firebase
                const usuariosSnapshot = await db.collection('usuarios').get();
                usuariosSnapshot.forEach(doc => {
                    const data = doc.data();
                    usuariosFirebase.push({
                        id: doc.id,
                        usuario: data.usuario,
                        password: data.password,
                        email: data.email,
                        licenseKey: data.licenseKey,
                        fechaCreacion: data.fechaCreacion,
                        origen: 'Firebase'
                    });
                });

                // Usuarios de Google
                const googleSnapshot = await db.collection('usuarios-google').get();
                googleSnapshot.forEach(doc => {
                    const data = doc.data();
                    usuariosGoogle.push({
                        id: doc.id,
                        usuario: data.nombre || data.email.split('@')[0],
                        email: data.email,
                        licenseKey: 'Google Auth',
                        fechaCreacion: data.fechaRegistro,
                        ultimoAcceso: data.ultimoAcceso,
                        foto: data.foto,
                        proveedor: 'Google',
                        origen: 'Google'
                    });
                });

                // Combinar todos los usuarios de Firebase
                const todosUsuarios = [...usuariosFirebase, ...usuariosGoogle];
                
                if (todosUsuarios.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No hay usuarios registrados</p>';
                    return;
                }

                // Obtener datos de licencias para mostrar informaci√≥n adicional
                const licenciasSnapshot = await db.collection('licencias').get();
                const licenciasMap = {};
                licenciasSnapshot.forEach(doc => {
                    licenciasMap[doc.data().licenseKey] = doc.data();
                });

                // Crear tabla de usuarios
                let html = '<table><thead><tr><th>Usuario</th><th>Email</th><th>Licencia/Tipo</th><th>Origen</th><th>Fecha</th><th>Nueva Contrase√±a</th><th>Acciones</th></tr></thead><tbody>';

                todosUsuarios.forEach((usuario, index) => {
                    const licencia = licenciasMap[usuario.licenseKey];
                    let clienteName = 'Sin informaci√≥n';
                    let tipoUsuario = '';
                    
                    if (usuario.origen === 'Google') {
                        clienteName = 'Google Authentication';
                        tipoUsuario = 'üîç Google';
                    } else {
                        clienteName = licencia ? licencia.clientName : 'Sin informaci√≥n';
                        tipoUsuario = 'üîë Licencia';
                    }
                    
                    const fechaCreacion = usuario.fechaCreacion || usuario.ultimoAcceso || 'No disponible';
                    const origen = usuario.origen || 'Desconocido';
                    
                    // Colores por origen
                    let origenStyle = '';
                    if (origen === 'Google') {
                        origenStyle = '#e3f2fd; color: #1565c0'; // Azul Google
                    } else if (origen === 'Firebase') {
                        origenStyle = '#e8f5e8; color: #2e7d32'; // Verde Firebase
                    } else {
                        origenStyle = '#fff3e0; color: #ef6c00'; // Naranja Local
                    }
                    
                    // Mostrar foto de perfil para usuarios de Google
                    const userIcon = usuario.foto ? 
                        `<img src="${usuario.foto}" alt="Foto" style="width: 24px; height: 24px; border-radius: 50%; margin-right: 8px; vertical-align: middle;">` : 
                        '';
                    
                    html += `
                        <tr>
                            <td data-label="Usuario">${userIcon}<strong>${usuario.usuario}</strong></td>
                            <td data-label="Email">${usuario.email || '-'}</td>
                            <td data-label="Licencia">${tipoUsuario} ${clienteName}</td>
                            <td data-label="Origen"><span style="padding: 2px 6px; border-radius: 3px; font-size: 10px; background: ${origenStyle}">${origen}</span></td>
                            <td data-label="Fecha" style="font-size: 11px;">${fechaCreacion}</td>
                            <td data-label="Nueva Contrase√±a">
                                ${usuario.origen === 'Google' ? 
                                    '<span style="color: #999; font-size: 11px;">üîí Google Auth</span>' :
                                    `<input type="text" id="newPass_${index}" placeholder="Nueva contrase√±a" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">`
                                }
                            </td>
                            <td data-label="Acciones">
                                <div class="license-actions" style="gap: 8px;">
                                    ${usuario.origen === 'Google' ? 
                                        `<button class="btn-secondary" style="padding: 6px 10px; font-size: 11px;" disabled>üîí Google</button>` :
                                        `<button class="btn-editar" onclick="resetearContrasena(${index}, '${usuario.usuario}')" style="padding: 6px 10px; font-size: 11px;">Resetear</button>`
                                    }
                                    <button class="btn-eliminar" onclick="eliminarUsuario(${index}, '${usuario.usuario}', '${origen}')" style="padding: 6px 10px; font-size: 11px;">Eliminar</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                
                // Mostrar estad√≠sticas
                const usuariosLocales = todosUsuarios.length - usuariosFirebase.length - usuariosGoogle.length;
                const statsHtml = `
                    <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px;">
                        üìä <strong>Total de usuarios:</strong> ${todosUsuarios.length} 
                        | üî• Firebase: ${usuariosFirebase.length} 
                        | üîç Google: ${usuariosGoogle.length}
                        | üíæ Local: ${usuariosLocales}
                    </div>
                `;
                
                const finalHtml = statsHtml + html;
                container.innerHTML = finalHtml;

            } catch (error) {
                console.error('Error al cargar usuarios:', error);
                container.innerHTML = `
                    <div style="text-align: center; color: #dc3545; padding: 20px; background: #fff5f5; border-radius: 6px; border: 1px solid #fed7d7;">
                        <h4>‚ùå Error al cargar usuarios</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <button onclick="cargarUsuarios()" style="margin-top: 10px; padding: 6px 12px;">üîÑ Reintentar</button>
                    </div>
                `;
            }
        }

        function mostrarImportarDatos() {
            document.getElementById('modalImportar').style.display = 'flex';
        }

        function cerrarImportarDatos() {
            document.getElementById('modalImportar').style.display = 'none';
            document.getElementById('usuarioImportar').value = '';
            document.getElementById('jsonImportar').value = '';
        }

        async function importarDatosUsuario() {
            const usuario = document.getElementById('usuarioImportar').value.trim();
            const jsonText = document.getElementById('jsonImportar').value.trim();
            
            if (!usuario || !jsonText) {
                alert('‚ùå Por favor completa todos los campos');
                return;
            }
            
            try {
                // Parsear el JSON
                const datos = JSON.parse(jsonText);
                
                if (!datos.clientes && !datos.ordenes && !datos.repuestos) {
                    alert('‚ùå El JSON debe contener al menos uno de: clientes, ordenes, repuestos');
                    return;
                }
                
                // Verificar que el usuario existe
                const snapshot = await db.collection('usuarios')
                    .where('usuario', '==', usuario)
                    .get();
                
                if (snapshot.empty) {
                    alert('‚ùå El usuario no existe. Cr√©alo primero.');
                    return;
                }
                
                if (!confirm(`¬øImportar datos a la cuenta de "${usuario}"?\n\nClientes: ${datos.clientes?.length || 0}\n√ìrdenes: ${datos.ordenes?.length || 0}\nRepuestos: ${datos.repuestos?.length || 0}\n\nEsto reemplazar√° los datos existentes.`)) {
                    return;
                }
                
                const userRef = db.collection('usuarios-data').doc(usuario);
                
                // Importar clientes
                if (datos.clientes && datos.clientes.length > 0) {
                    const clientesRef = userRef.collection('clientes');
                    for (const cliente of datos.clientes) {
                        await clientesRef.add(cliente);
                    }
                }
                
                // Importar √≥rdenes
                if (datos.ordenes && datos.ordenes.length > 0) {
                    const ordenesRef = userRef.collection('ordenes');
                    for (const orden of datos.ordenes) {
                        await ordenesRef.add(orden);
                    }
                }
                
                // Importar repuestos
                if (datos.repuestos && datos.repuestos.length > 0) {
                    const repuestosRef = userRef.collection('repuestos');
                    for (const repuesto of datos.repuestos) {
                        await repuestosRef.add(repuesto);
                    }
                }
                
                // Actualizar metadata del usuario
                await userRef.set({ 
                    ultimaActualizacion: new Date().toISOString(),
                    usuario: usuario,
                    datosImportados: true
                }, { merge: true });
                
                alert(`‚úÖ Datos importados exitosamente\n\nClientes: ${datos.clientes?.length || 0}\n√ìrdenes: ${datos.ordenes?.length || 0}\nRepuestos: ${datos.repuestos?.length || 0}`);
                
                cerrarImportarDatos();
                
            } catch (error) {
                console.error('Error al importar datos:', error);
                alert('‚ùå Error al importar datos. Verifica que el JSON sea v√°lido.');
            }
        }

        async function resetearContrasena(index, nombreUsuario) {
            const nuevaPass = document.getElementById(`newPass_${index}`).value;
            
            if (!nuevaPass || nuevaPass.trim().length < 4) {
                alert('‚ùå Ingresa una contrase√±a de al menos 4 caracteres');
                return;
            }

            if (!confirm(`¬øEst√°s seguro de resetear la contrase√±a de ${nombreUsuario} a "${nuevaPass}"?`)) {
                return;
            }

            try {
                // Buscar el usuario en Firebase
                const snapshot = await db.collection('usuarios')
                    .where('usuario', '==', nombreUsuario)
                    .get();

                if (snapshot.empty) {
                    alert('‚ùå Usuario no encontrado en Firebase');
                    return;
                }
                
                // Actualizar la contrase√±a en Firebase
                const doc = snapshot.docs[0];
                await doc.ref.update({
                    password: nuevaPass,
                    fechaReseteo: new Date().toISOString(),
                    resetadoPor: 'admin'
                });

                alert(`‚úÖ Contrase√±a actualizada correctamente\n\nUsuario: ${nombreUsuario}\nNueva contrase√±a: ${nuevaPass}`);
                document.getElementById(`newPass_${index}`).value = '';
                await cargarUsuarios();
            } catch (error) {
                console.error('Error al resetear contrase√±a:', error);
                alert('‚ùå Error al actualizar la contrase√±a');
            }
        }

        async function eliminarUsuario(index, nombreUsuario) {
            if (!confirm(`¬øEst√°s seguro de eliminar al usuario ${nombreUsuario}?\n\nEsta acci√≥n no se puede deshacer.`)) {
                return;
            }

            try {
                // Buscar y eliminar de Firebase
                const snapshot = await db.collection('usuarios')
                    .where('usuario', '==', nombreUsuario)
                    .get();

                if (snapshot.empty) {
                    alert('‚ùå Usuario no encontrado en Firebase');
                    return;
                }

                // Eliminar todos los documentos que coincidan
                snapshot.forEach(doc => {
                    doc.ref.delete();
                });

                alert('‚úÖ Usuario eliminado correctamente de Firebase');
                await cargarUsuarios();
            } catch (error) {
                console.error('Error al eliminar usuario:', error);
                alert('‚ùå Error al eliminar el usuario');
            }
        }

        async function descargarLicencia() {
            try {
                // Obtener la √∫ltima licencia desde Firebase
                const snapshot = await db.collection('licencias')
                    .orderBy('fechaCreacion', 'desc')
                    .limit(1)
                    .get();

                if (snapshot.empty) {
                    alert('‚ùå No hay licencias para descargar');
                    return;
                }

                const ultimaLicencia = snapshot.docs[0].data();

                const contenido = `
TU TALLER - SISTEMA DE GESTI√ìN
================================
LICENCIA DE SOFTWARE
================================

Cliente: ${ultimaLicencia.clientName}
Email: ${ultimaLicencia.clientEmail}
Tipo de Licencia: ${ultimaLicencia.licenseType}
M√°ximo de Dispositivos: ${ultimaLicencia.maxDevices}

CLAVE DE LICENCIA:
${ultimaLicencia.licenseKey}

Fecha de Creaci√≥n: ${new Date(ultimaLicencia.fechaCreacion).toLocaleString()}
${ultimaLicencia.fechaExpiracion ? `Fecha de Expiraci√≥n: ${new Date(ultimaLicencia.fechaExpiracion).toLocaleString()}` : 'Sin fecha de expiraci√≥n'}

================================
INSTRUCCIONES DE ACTIVACI√ìN
================================

1. Abra el sistema "Tu Taller"
2. Haga clic en "Activar Licencia"
3. Ingrese la clave de licencia
4. Complete el registro con su usuario y contrase√±a
5. Inicie sesi√≥n con sus credenciales

Para soporte t√©cnico, contacte a:
soporte@tutaller.com

¬© ${new Date().getFullYear()} Tu Taller - Todos los derechos reservados
            `;

                const blob = new Blob([contenido], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Licencia_${ultimaLicencia.clientName.replace(/\s+/g, '_')}_${Date.now()}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Error al descargar licencia:', error);
                alert('‚ùå Error al descargar la licencia');
            }
        }

        // ====== FUNCIONES DE CONSULTA DE LICENCIA ======
        
        function mostrarConsultaLicencia() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('consultaLicenciaSection').style.display = 'block';
            document.getElementById('backBtn').style.display = 'block';
        }

        function volverLogin() {
            document.getElementById('consultaLicenciaSection').style.display = 'none';
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('backBtn').style.display = 'none';
            
            // Limpiar formulario y resultados
            document.getElementById('consultaForm').reset();
            document.getElementById('licenseDataView').style.display = 'none';
            document.getElementById('consultaError').style.display = 'none';
            document.getElementById('consultaSuccess').style.display = 'none';
        }

        async function consultarLicencia(event) {
            event.preventDefault();
            
            const licenseKey = document.getElementById('licenseKeyConsulta').value.trim();
            const errorDiv = document.getElementById('consultaError');
            const successDiv = document.getElementById('consultaSuccess');
            const dataView = document.getElementById('licenseDataView');
            const dataContent = document.getElementById('licenseDataContent');
            
            // Ocultar mensajes previos
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            dataView.style.display = 'none';
            
            try {
                // Buscar licencia en Firebase
                const snapshot = await db.collection('licencias')
                    .where('licenseKey', '==', licenseKey)
                    .get();
                
                if (snapshot.empty) {
                    errorDiv.textContent = '‚ùå Licencia no encontrada. Verifica la clave e intenta nuevamente.';
                    errorDiv.style.display = 'block';
                    return;
                }
                
                const licencia = snapshot.docs[0].data();
                
                // Verificar estado de la licencia
                const ahora = new Date();
                const fechaExp = licencia.fechaExpiracion ? new Date(licencia.fechaExpiracion) : null;
                const estaExpirada = fechaExp && fechaExp < ahora;
                const diasRestantes = fechaExp ? Math.ceil((fechaExp - ahora) / (1000 * 60 * 60 * 24)) : null;
                
                // Obtener usuarios registrados con esta licencia
                const usuariosSnapshot = await db.collection('usuarios')
                    .where('licenseKey', '==', licenseKey)
                    .get();
                
                const usuariosRegistrados = [];
                usuariosSnapshot.forEach(doc => {
                    const userData = doc.data();
                    usuariosRegistrados.push({
                        usuario: userData.usuario,
                        email: userData.email,
                        fechaCreacion: userData.fechaCreacion
                    });
                });
                
                const tipoTexto = {
                    prueba: 'Prueba (3 d√≠as)',
                    mensual: 'Mensual (30 d√≠as)',
                    trimestral: 'Trimestral (90 d√≠as)',
                    semestral: 'Semestral (180 d√≠as)',
                    anual: 'Anual (365 d√≠as)',
                    vitalicia: 'Vitalicia (Sin expiraci√≥n)'
                };
                
                // Determinar estado y clase
                let estadoHTML = '';
                let estadoClase = '';
                
                if (licencia.suspendida) {
                    estadoHTML = '<span class="status-badge status-suspended">‚è∏Ô∏è SUSPENDIDA</span>';
                    estadoClase = 'status-suspended';
                } else if (estaExpirada) {
                    estadoHTML = '<span class="status-badge status-expired">‚è∞ EXPIRADA</span>';
                    estadoClase = 'status-expired';
                } else if (!licencia.activa) {
                    estadoHTML = '<span class="status-badge status-inactive">‚ùå INACTIVA</span>';
                    estadoClase = 'status-inactive';
                } else {
                    estadoHTML = '<span class="status-badge status-active">‚úÖ ACTIVA</span>';
                    estadoClase = 'status-active';
                }
                
                // Mostrar informaci√≥n de la licencia
                dataContent.innerHTML = `
                    <div style="text-align: center; margin-bottom: 25px;">
                        ${estadoHTML}
                    </div>
                    
                    <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: #374151;">üîë Clave de Licencia</h4>
                        <p style="font-family: 'Courier New', monospace; background: white; padding: 12px; border-radius: 6px; border: 2px solid #10b981; font-size: 14px; font-weight: 600; color: #059669; word-break: break-all; margin: 0;">
                            ${licencia.licenseKey}
                        </p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border-left: 4px solid #3b82f6;">
                            <p style="margin: 0 0 5px 0; font-size: 12px; color: #6b7280; font-weight: 600;">üë§ CLIENTE</p>
                            <p style="margin: 0; font-size: 16px; color: #1f2937; font-weight: 600;">${licencia.clientName}</p>
                        </div>
                        
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;">
                            <p style="margin: 0 0 5px 0; font-size: 12px; color: #6b7280; font-weight: 600;">üìß EMAIL</p>
                            <p style="margin: 0; font-size: 14px; color: #1f2937; word-break: break-all;">${licencia.clientEmail}</p>
                        </div>
                        
                        <div style="background: #fef3c7; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                            <p style="margin: 0 0 5px 0; font-size: 12px; color: #6b7280; font-weight: 600;">üìã TIPO</p>
                            <p style="margin: 0; font-size: 14px; color: #1f2937; font-weight: 600;">${tipoTexto[licencia.licenseType]}</p>
                        </div>
                        
                        <div style="background: #fce7f3; padding: 15px; border-radius: 8px; border-left: 4px solid #ec4899;">
                            <p style="margin: 0 0 5px 0; font-size: 12px; color: #6b7280; font-weight: 600;">üì± DISPOSITIVOS</p>
                            <p style="margin: 0; font-size: 16px; color: #1f2937; font-weight: 600;">${usuariosRegistrados.length} / ${licencia.maxDevices}</p>
                        </div>
                    </div>
                    
                    <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #374151;">üìÖ Fechas Importantes</h4>
                        <div style="display: grid; gap: 10px;">
                            <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px;">
                                <span style="color: #6b7280; font-weight: 600;">Fecha de Creaci√≥n:</span>
                                <span style="color: #1f2937; font-weight: 600;">${new Date(licencia.fechaCreacion).toLocaleDateString('es-ES')}</span>
                            </div>
                            ${licencia.fechaExpiracion ? `
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px;">
                                    <span style="color: #6b7280; font-weight: 600;">Fecha de Expiraci√≥n:</span>
                                    <span style="color: ${estaExpirada ? '#dc2626' : '#059669'}; font-weight: 600;">${new Date(licencia.fechaExpiracion).toLocaleDateString('es-ES')}</span>
                                </div>
                                ${!estaExpirada ? `
                                    <div style="display: flex; justify-content: space-between; padding: 10px; background: #ecfdf5; border-radius: 6px; border: 1px solid #10b981;">
                                        <span style="color: #059669; font-weight: 600;">‚è≥ D√≠as Restantes:</span>
                                        <span style="color: #059669; font-weight: 700; font-size: 18px;">${diasRestantes} d√≠as</span>
                                    </div>
                                ` : ''}
                            ` : `
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: #ecfdf5; border-radius: 6px; border: 1px solid #10b981;">
                                    <span style="color: #059669; font-weight: 600;">‚ôæÔ∏è Licencia Vitalicia</span>
                                    <span style="color: #059669; font-weight: 700;">Sin expiraci√≥n</span>
                                </div>
                            `}
                        </div>
                    </div>
                    
                    ${usuariosRegistrados.length > 0 ? `
                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px;">
                            <h4 style="margin: 0 0 15px 0; color: #374151;">üë• Dispositivos Registrados</h4>
                            <div style="display: grid; gap: 10px;">
                                ${usuariosRegistrados.map(user => `
                                    <div style="background: white; padding: 12px; border-radius: 6px; border-left: 3px solid #3b82f6;">
                                        <p style="margin: 0 0 5px 0; color: #1f2937; font-weight: 600;">üë§ ${user.usuario}</p>
                                        <p style="margin: 0; color: #6b7280; font-size: 12px;">üìß ${user.email}</p>
                                        <p style="margin: 5px 0 0 0; color: #9ca3af; font-size: 11px;">Registrado: ${new Date(user.fechaCreacion).toLocaleDateString('es-ES')}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : `
                        <div style="background: #fef3c7; padding: 15px; border-radius: 8px; text-align: center;">
                            <p style="margin: 0; color: #92400e; font-weight: 600;">‚ö†Ô∏è No hay dispositivos registrados con esta licencia</p>
                        </div>
                    `}
                `;
                
                successDiv.textContent = '‚úÖ Licencia encontrada correctamente';
                successDiv.style.display = 'block';
                dataView.style.display = 'block';
                
            } catch (error) {
                console.error('Error al consultar licencia:', error);
                errorDiv.textContent = '‚ùå Error al consultar la licencia. Intenta nuevamente.';
                errorDiv.style.display = 'block';
            }
        }
    </script>
    
    <!-- Environment Variables -->
    <script src="env.js"></script>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-licencias.js"></script>
</body>
</html>
